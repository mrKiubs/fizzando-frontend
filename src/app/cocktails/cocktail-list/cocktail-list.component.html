<div class="page-header-container" [class.fonts-loaded]="fontsLoaded">
  <h1 class="page-title">{{ pageH1 }}</h1>
  <h2 class="page-subtitle">{{ pageH2 }}</h2>
  <!-- opzionale: piccola descrizione (non H3 per SEO, solo testo) -->
  <p class="page-lead sr-only" *ngIf="pageDescription">{{ pageDescription }}</p>
</div>

<!-- HUB SWITCHER (link a sezioni) -->
<section
  class="hub-switcher cut"
  role="navigation"
  aria-label="Explore sections"
>
  <h3 class="hub-switcher__title">Explore sections</h3>

  <app-facet-chips
    label="By method"
    kind="method"
    [items]="[
      'Built in Glass',
      'Shaken',
      'Stirred',
      'Blended',
      'Other',
      'Layered',
      'Muddled',
      'Built in Punch Bowl',
      'Heated',
      'Infusion & Aging',
      'Bomb Shot'
    ]"
    [activeKind]="hubKind"
    [activeSlug]="hubSlug"
  >
  </app-facet-chips>

  <app-facet-chips
    label="By glass"
    kind="glass"
    [items]="[
      'Cocktail Glass',
      'Highball Glass',
      'Collins Glass',
      'Old Fashioned Glass',
      'Shot Glass',
      'Coffee Mug',
      'Whiskey Sour Glass',
      'Hurricane Glass',
      'Punch Bowl',
      'Wine Glass',
      'Champagne Flute',
      'Irish Coffee Glass',
      'Pint Glass',
      'Beer Glass',
      'Pitcher',
      'Beer Mug',
      'Margarita Glass',
      'Mason Jar',
      'Balloon Glass',
      'Coupe Glass',
      'Cordial Glass',
      'Brandy Snifter',
      'Nick & Nora Glass',
      'Julep Cup',
      'Copper Mug'
    ]"
    [activeKind]="hubKind"
    [activeSlug]="hubSlug"
  >
  </app-facet-chips>

  <app-facet-chips
    label="By category"
    kind="category"
    [items]="[
      'Refreshing',
      'After-Dinner',
      'Sour',
      'Tropical',
      'Spirit-Forward',
      'Classic',
      'Hot',
      'Aperitif',
      'Sparkling',
      'Flaming',
      'Punch',
      'Shot',
      'Beer',
      'Aromatic',
      'Homemade Liqueur'
    ]"
    [activeKind]="hubKind"
    [activeSlug]="hubSlug"
  >
  </app-facet-chips>

  <app-facet-chips
    label="By profile"
    kind="alcoholic"
    [items]="alcoholicOptions"
    [activeKind]="hubKind"
    [activeSlug]="hubSlug"
  >
  </app-facet-chips>
</section>

<!-- SEARCH (solo nel ROOT) -->
<div class="custom-search-input-wrapper" *ngIf="isRootHubView()">
  <label for="cocktail-search" class="sr-only">Search cocktails</label>
  <input
    type="search"
    id="cocktail-search"
    name="q"
    class="custom-search-input"
    placeholder="Search cocktails by name..."
    [value]="searchTerm()"
    (input)="onSearchInput($event)"
    autocomplete="off"
    autocorrect="off"
    autocapitalize="off"
    spellcheck="false"
    inputmode="search"
    enterkeyhint="search"
  />

  <mat-icon
    class="search-icon"
    svgIcon="search"
    aria-hidden="true"
    *ngIf="!searchTerm()"
  ></mat-icon>
  <mat-icon
    class="clear-search-icon"
    svgIcon="close"
    aria-hidden="true"
    *ngIf="searchTerm()"
    (click)="setSearch('')"
  ></mat-icon>
</div>

<!-- FILTERS (accordion) — TUTTE LE PAGINE, SOLO LETTERE -->
<div class="filters-accordion" [class.expanded]="isExpanded()">
  <div class="accordion-header" #filtersToggle (click)="toggleExpansion()">
    <h3 class="accordion-title">
      <mat-icon
        class="accordion-icon"
        svgIcon="filter_list"
        aria-hidden="true"
      ></mat-icon>
      Filter by letter
    </h3>
    <span class="active-filters-summary" *ngIf="!isExpanded()">
      ({{ getActiveFiltersText() }})
    </span>
  </div>

  @defer (on interaction(filtersToggle); prefetch on idle) {
  <div class="accordion-content" *ngIf="isExpanded()">
    <div class="letter-filter">
      <div
        class="letter-filter__chips"
        role="group"
        aria-label="Filter cocktails by first letter"
      >
        <!-- All -->
        <a
          [attr.href]="buildUrlWithParams({ letter: null, page: 1 })"
          class="chip"
          [class.active]="!selectedLetter()"
          (click)="$event.preventDefault(); onLetterChipClick($event, null)"
        >
          All
        </a>

        <!-- 0–9 -->
        <a
          [attr.href]="buildUrlWithParams({ letter: numberKey, page: 1 })"
          class="chip"
          [class.active]="selectedLetter() === numberKey"
          [class.disabled]="
            letterAvailabilityLoaded && !availableLetters.has(numberKey)
          "
          (click)="
            $event.preventDefault(); onLetterChipClick($event, numberKey)
          "
          [attr.aria-pressed]="selectedLetter() === numberKey"
          [attr.aria-disabled]="
            letterAvailabilityLoaded && !availableLetters.has(numberKey)
          "
          [attr.tabindex]="
            letterAvailabilityLoaded && !availableLetters.has(numberKey)
              ? -1
              : null
          "
          aria-label="Filter by number"
        >
          0–9
        </a>

        <!-- A–Z -->
        <ng-container *ngFor="let letter of letters">
          <a
            [attr.href]="buildUrlWithParams({ letter: letter, page: 1 })"
            class="chip"
            [class.active]="selectedLetter() === letter"
            [class.disabled]="
              letterAvailabilityLoaded && !availableLetters.has(letter)
            "
            (click)="$event.preventDefault(); onLetterChipClick($event, letter)"
            [attr.aria-pressed]="selectedLetter() === letter"
            [attr.aria-disabled]="
              letterAvailabilityLoaded && !availableLetters.has(letter)
            "
            [attr.tabindex]="
              letterAvailabilityLoaded && !availableLetters.has(letter)
                ? -1
                : null
            "
            [attr.aria-label]="'Filter by letter ' + letter"
          >
            {{ letter }}
          </a>
        </ng-container>
      </div>
    </div>
  </div>
  } @placeholder {
  <div class="accordion-content placeholder" aria-hidden="true"></div>
  }
</div>

<!-- STATUS ALERT (green, bouncing arrows) -->
<div
  *ngIf="!error"
  class="results-alert success bouncy"
  role="status"
  aria-live="polite"
>
  <ng-container *ngIf="loading; else countsLoadedCL">
    <mat-icon
      class="status-icon spinner"
      svgIcon="search"
      aria-hidden="true"
    ></mat-icon>
    <span>Searching cocktails…</span>
  </ng-container>

  <ng-template #countsLoadedCL>
    <div class="arrows" aria-hidden="true">
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
    </div>

    <span class="status-text">
      <b>{{ totalItems }}</b>
      {{ totalItems === 1 ? "cocktail" : "cocktails" }} found<br />
      <ng-container *ngIf="getActiveFiltersText() !== 'No filters active'">
        filters: <b>{{ getActiveFiltersText() }}</b>
      </ng-container>
    </span>

    <div class="arrows" aria-hidden="true">
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
    </div>
  </ng-template>
</div>

<hr />

<p class="cocktail-card-legend">
  Each card shows the cocktail’s <b>image</b>, <b>category</b>, estimated
  <b>ABV (Alcohol By Volume)</b>, <b>key ingredients</b>, and the
  <b>recommended glass</b>. Click a cocktail to view full details!
</p>

<div *ngIf="loading" class="loading-message">Loading cocktails...</div>
<div *ngIf="error" class="error-message">{{ error }}</div>

<!-- STATUS PAGINA / RISULTATI -->
<div
  class="page-status"
  *ngIf="!loading && !error && totalItems > 0"
  role="status"
  aria-live="polite"
>
  <span class="page-status__page"
    >Page {{ currentPage }} of {{ totalPages }}</span
  >
  <span class="page-status__sep" aria-hidden="true">•</span>
  <span class="page-status__range">
    Showing {{ pageStart }}–{{ pageEnd }} of {{ totalItems }}
  </span>
</div>

<!-- Skeleton quando loading -->
<div
  class="page-status page-status--skeleton"
  *ngIf="loading"
  aria-hidden="true"
>
  <span class="skl w-28"></span>
  <span class="skl w-6"></span>
  <span class="skl w-48"></span>
</div>

<div class="glass-card cocktail-list" *ngIf="!error && cocktails.length > 0">
  <ng-container
    *ngFor="
      let cocktail of cocktails;
      let i = index;
      trackBy: trackByCocktailId
    "
  >
    <app-cocktail-card
      [cocktail]="cocktail"
      [isLcp]="i === 0"
    ></app-cocktail-card>

    <ng-container *ngIf="i > 0 && (i + 1) % 6 === 0">
      @defer (on viewport) {
      <section
        class="ad-block"
        role="complementary"
        aria-label="Sponsored content"
      >
        <span class="ad-badge">Ad</span>
        <app-dev-ads
          [type]="isMobile ? 'responsive' : 'small-square'"
        ></app-dev-ads>
      </section>
      } @placeholder {
      <section
        class="ad-block"
        role="complementary"
        aria-label="Sponsored content"
        aria-hidden="true"
      >
        <span class="ad-badge">Ad</span>
        <app-dev-ads
          [type]="isMobile ? 'responsive' : 'small-square'"
        ></app-dev-ads>
      </section>
      }
    </ng-container>
  </ng-container>
</div>

<div class="no-results-message" *ngIf="!loading && !cocktails.length">
  <p>No cocktails match your criteria. Try adjusting your filters!</p>
</div>

<div class="pagination-container" *ngIf="!loading && totalPages > 1">
  <div class="pagination-controls">
    <!-- Prev -->
    <ng-container *ngIf="currentPage > 1; else prevDisabled">
      <a
        [attr.href]="buildUrlWithParams({ page: currentPage - 1 })"
        class="page-number nav-arrow"
        aria-label="Go to previous page"
        (click)="$event.preventDefault(); goToPage(currentPage - 1)"
      >
        <mat-icon aria-hidden="true">chevron_left</mat-icon>
      </a>
    </ng-container>
    <ng-template #prevDisabled>
      <button
        type="button"
        class="page-number nav-arrow"
        aria-label="Previous page"
        disabled
      >
        <mat-icon aria-hidden="true">chevron_left</mat-icon>
      </button>
    </ng-template>

    <!-- Pagine -->
    <div class="page-numbers" role="navigation" aria-label="Pagination">
      <ng-container *ngIf="totalPages > 1">
        <span
          *ngIf="currentPage === 1"
          class="page-number active"
          aria-current="page"
          >1</span
        >
        <a
          *ngIf="currentPage !== 1"
          [attr.href]="buildUrlWithParams({ page: 1 })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(1)"
          >1</a
        >
      </ng-container>

      <span *ngIf="showFirstEllipsis()" class="ellipsis" aria-hidden="true"
        >…</span
      >

      <ng-container *ngFor="let page of getVisiblePages()">
        <span
          *ngIf="page === currentPage"
          class="page-number active"
          aria-current="page"
          >{{ page }}</span
        >
        <a
          *ngIf="page !== currentPage"
          [attr.href]="buildUrlWithParams({ page: page })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(page)"
          >{{ page }}</a
        >
      </ng-container>

      <span *ngIf="showLastEllipsis()" class="ellipsis" aria-hidden="true"
        >…</span
      >

      <ng-container *ngIf="totalPages > 1">
        <span
          *ngIf="currentPage === totalPages"
          class="page-number active"
          aria-current="page"
          >{{ totalPages }}</span
        >
        <a
          *ngIf="currentPage !== totalPages"
          [attr.href]="buildUrlWithParams({ page: totalPages })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(totalPages)"
          >{{ totalPages }}</a
        >
      </ng-container>
    </div>

    <!-- Next -->
    <ng-container *ngIf="currentPage < totalPages; else nextDisabled">
      <a
        [attr.href]="buildUrlWithParams({ page: currentPage + 1 })"
        class="page-number nav-arrow"
        aria-label="Go to next page"
        (click)="$event.preventDefault(); goToPage(currentPage + 1)"
      >
        <mat-icon aria-hidden="true">chevron_right</mat-icon>
      </a>
    </ng-container>
    <ng-template #nextDisabled>
      <button
        type="button"
        class="page-number nav-arrow"
        aria-label="Next page"
        disabled
      >
        <mat-icon aria-hidden="true">chevron_right</mat-icon>
      </button>
    </ng-template>
  </div>
</div>

<div class="key-features-section" *ngIf="keyFeatures.length">
  <h3>{{ keyFeaturesHeading }}</h3>

  <div
    class="feature-item"
    *ngFor="let feature of keyFeatures; trackBy: trackByIndex"
  >
    <span class="feature-icon" aria-hidden="true">{{ feature.icon }}</span>
    <div class="feature-copy">
      <h4 class="feature-title">{{ feature.title }}</h4>
      <p class="feature-description">
        <ng-container *ngFor="let segment of feature.segments">
          <ng-container *ngIf="segment.kind === 'text'">
            <span
              [style.font-weight]="segment.emphasis === 'strong' ? '600' : null"
              >{{ segment.value }}</span
            >
          </ng-container>
          <ng-container *ngIf="segment.kind === 'routerLink'">
            <a
              [routerLink]="segment.commands"
              [queryParams]="segment.queryParams || undefined"
              [fragment]="segment.fragment || undefined"
            >
              <span
                [style.font-weight]="
                  segment.emphasis === 'strong' ? '600' : null
                "
                >{{ segment.label }}</span
              >
            </a>
          </ng-container>
          <ng-container *ngIf="segment.kind === 'externalLink'">
            <a
              [attr.href]="segment.href"
              [attr.target]="segment.target || null"
              [attr.rel]="segment.rel || null"
            >
              <span
                [style.font-weight]="
                  segment.emphasis === 'strong' ? '600' : null
                "
                >{{ segment.label }}</span
              >
            </a>
          </ng-container>
        </ng-container>
      </p>
    </div>
  </div>
</div>

@defer (on viewport) {
<div class="bottom-container">
  <div class="faq-section" *ngIf="faqEntries.length">
    <h2>{{ faqHeading }}</h2>

    <div
      class="faq-item"
      *ngFor="let faq of faqEntries; let i = index; trackBy: trackByIndex"
      [class.expanded]="faqStates[i].isExpanded"
    >
      <button
        class="faq-question"
        type="button"
        (click)="toggleFaq(i)"
        [attr.aria-expanded]="faqStates[i].isExpanded"
      >
        <span>{{ faq.question }}</span>
        <mat-icon class="faq-toggle-icon" svgIcon="arrow_drop_down"></mat-icon>
      </button>

      <div
        #answer
        class="faq-answer-wrapper"
        [style.maxHeight.px]="faqStates[i].isExpanded ? answer.scrollHeight : 0"
      >
        <p class="faq-answer">
          <ng-container *ngFor="let segment of faq.answer">
            <ng-container *ngIf="segment.kind === 'text'">
              <span
                [style.font-weight]="
                  segment.emphasis === 'strong' ? '600' : null
                "
                >{{ segment.value }}</span
              >
            </ng-container>
            <ng-container *ngIf="segment.kind === 'routerLink'">
              <a
                [routerLink]="segment.commands"
                [queryParams]="segment.queryParams || undefined"
                [fragment]="segment.fragment || undefined"
              >
                <span
                  [style.font-weight]="
                    segment.emphasis === 'strong' ? '600' : null
                  "
                  >{{ segment.label }}</span
                >
              </a>
            </ng-container>
            <ng-container *ngIf="segment.kind === 'externalLink'">
              <a
                [href]="segment.href"
                [attr.target]="segment.target || '_blank'"
                [attr.rel]="segment.rel || 'noopener noreferrer'"
              >
                <span
                  [style.font-weight]="
                    segment.emphasis === 'strong' ? '600' : null
                  "
                  >{{ segment.label }}</span
                >
              </a>
            </ng-container>
          </ng-container>
        </p>
      </div>
    </div>
  </div>

  @defer (on viewport) {
  <section class="ad-block" role="complementary" aria-label="Sponsored content">
    <span class="ad-badge">Ad</span>
    <app-dev-ads [type]="isMobile ? 'responsive' : 'half-page'"></app-dev-ads>
  </section>
  } @placeholder {
  <section
    class="ad-block"
    role="complementary"
    aria-label="Sponsored content"
    aria-hidden="true"
  >
    <span class="ad-badge">Ad</span>
    <app-dev-ads [type]="isMobile ? 'responsive' : 'half-page'"></app-dev-ads>
  </section>
  }
</div>
} @placeholder {
<div class="bottom-container placeholder" aria-hidden="true">
  <div class="faq-section skeleton"></div>
</div>
}
