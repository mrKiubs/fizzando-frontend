<!-- src/app/cocktails/cocktail-list/cocktail-list.component.html -->
<div class="page-header-container">
  <h1 class="page-title">{{ pageH1 }}</h1>
  <h2 class="page-subtitle">
    {{ pageH2 }}
  </h2>

  <!-- SEO: intro visibile (prima era sr-only). Breve, naturale, con sinonimi -->
  <p class="page-lead" *ngIf="pageDescription">
    {{ pageDescription }}
  </p>
</div>

<!-- HUB SWITCHER (link a sezioni) -->
<section
  class="container-tab glass-card"
  role="navigation"
  aria-label="Explore sections"
>
  <h3 class="hub-switcher__title">Explore sections by</h3>

  <!-- TABS (Material-free) -->
  <nav
    class="tabs"
    role="tablist"
    aria-label="Explore sections"
    (keydown)="onTabsKeydown($event)"
  >
    <button
      id="tab-method"
      role="tab"
      aria-controls="panel-method"
      type="button"
      [class.active]="selectedTab === 'method'"
      [attr.aria-selected]="selectedTab === 'method'"
      [attr.tabindex]="selectedTab === 'method' ? 0 : -1"
      (click)="selectTab('method')"
    >
      method
    </button>

    <button
      id="tab-glass"
      role="tab"
      aria-controls="panel-glass"
      type="button"
      [class.active]="selectedTab === 'glass'"
      [attr.aria-selected]="selectedTab === 'glass'"
      [attr.tabindex]="selectedTab === 'glass' ? 0 : -1"
      (click)="selectTab('glass')"
    >
      glass
    </button>

    <button
      id="tab-category"
      role="tab"
      aria-controls="panel-category"
      type="button"
      [class.active]="selectedTab === 'category'"
      [attr.aria-selected]="selectedTab === 'category'"
      [attr.tabindex]="selectedTab === 'category' ? 0 : -1"
      (click)="selectTab('category')"
    >
      category
    </button>

    <button
      id="tab-alcoholic"
      role="tab"
      aria-controls="panel-alcoholic"
      type="button"
      [class.active]="selectedTab === 'alcoholic'"
      [attr.aria-selected]="selectedTab === 'alcoholic'"
      [attr.tabindex]="selectedTab === 'alcoholic' ? 0 : -1"
      (click)="selectTab('alcoholic')"
    >
      profile
    </button>
  </nav>

  <!-- PANELS (lazy render con *ngIf) -->
  <section
    [hidden]="selectedTab !== 'method'"
    id="panel-method"
    class="hub-switcher cut"
    role="tabpanel"
    [attr.aria-labelledby]="'tab-method'"
  >
    <!-- ⤵️ INCOLLA QUI il tuo div .link-section-method (immutato) -->

    <div class="link-section link-section-method">
      <!-- Micro-copy SEO sopra i blocchi chips -->
      <p class="chip-lead">
        Browse cocktails by <strong>preparation method</strong> to discover
        classic and modern recipes mixed, shaken, stirred, or layered — a clean,
        Wikipedia-style map of techniques across the site.
      </p>
      <app-facet-chips
        label="By method"
        kind="method"
        [items]="[
          'Built in Glass',
          'Shaken',
          'Stirred',
          'Blended',
          'Other',
          'Layered',
          'Muddled',
          'Built in Punch Bowl',
          'Heated',
          'Infusion & Aging',
          'Bomb Shot'
        ]"
        [activeKind]="hubKind"
        [activeSlug]="hubSlug"
      >
      </app-facet-chips>
    </div>
  </section>

  <section
    [hidden]="selectedTab !== 'glass'"
    id="panel-glass"
    class="hub-switcher cut"
    role="tabpanel"
    [attr.aria-labelledby]="'tab-glass'"
  >
    <div class="link-section link-section-glass">
      <p class="chip-lead">
        Explore cocktails by <strong>glassware</strong> — from highballs to
        coupes. Glass type hints at style, dilution and presentation, helping
        you jump to the right family of drinks.
      </p>
      <app-facet-chips
        label="By glass"
        kind="glass"
        [items]="[
          'Cocktail Glass',
          'Highball Glass',
          'Collins Glass',
          'Old Fashioned Glass',
          'Shot Glass',
          'Coffee Mug',
          'Whiskey Sour Glass',
          'Hurricane Glass',
          'Punch Bowl',
          'Wine Glass',
          'Champagne Flute',
          'Irish Coffee Glass',
          'Pint Glass',
          'Beer Glass',
          'Pitcher',
          'Beer Mug',
          'Margarita Glass',
          'Mason Jar',
          'Balloon Glass',
          'Coupe Glass',
          'Cordial Glass',
          'Brandy Snifter',
          'Nick & Nora Glass',
          'Julep Cup',
          'Copper Mug'
        ]"
        [activeKind]="hubKind"
        [activeSlug]="hubSlug"
      >
      </app-facet-chips>
    </div>
  </section>

  <section
    [hidden]="selectedTab !== 'category'"
    id="panel-category"
    class="hub-switcher cut"
    role="tabpanel"
    [attr.aria-labelledby]="'tab-category'"
  >
    <div class="link-section link-section-categories">
      <p class="chip-lead">
        Jump into <strong>categories</strong> that match a mood or flavor
        profile — refreshing, tropical, spirit-forward, after-dinner, sparkling
        and more.
      </p>
      <app-facet-chips
        label="By category"
        kind="category"
        [items]="[
          'Refreshing',
          'After-Dinner',
          'Sour',
          'Tropical',
          'Spirit-Forward',
          'Classic',
          'Hot',
          'Aperitif',
          'Sparkling',
          'Flaming',
          'Punch',
          'Shot',
          'Beer',
          'Aromatic',
          'Homemade Liqueur'
        ]"
        [activeKind]="hubKind"
        [activeSlug]="hubSlug"
      >
      </app-facet-chips>
    </div>
  </section>

  <section
    [hidden]="selectedTab !== 'alcoholic'"
    id="panel-alcoholic"
    class="hub-switcher cut"
    role="tabpanel"
    [attr.aria-labelledby]="'tab-alcoholic'"
  >
    <div class="link-section link-section-alcholic">
      <p class="chip-lead">
        Filter by <strong>alcohol profile</strong> — from non-alcoholic and
        low-ABV options to full-strength classics.
      </p>
      <app-facet-chips
        label="By profile"
        kind="alcoholic"
        [items]="alcoholicOptions"
        [activeKind]="hubKind"
        [activeSlug]="hubSlug"
      >
      </app-facet-chips>
    </div>
  </section>
</section>

<!-- SEARCH (solo nel ROOT) -->
<div class="custom-search-input-wrapper" *ngIf="isRootHubView()">
  <label for="cocktail-search" class="sr-only">Search cocktails</label>
  <input
    type="search"
    id="cocktail-search"
    name="q"
    class="custom-search-input"
    placeholder="Search cocktails by name..."
    [value]="searchTerm()"
    (input)="onSearchInput($event)"
    autocomplete="off"
    autocorrect="off"
    autocapitalize="off"
    spellcheck="false"
    inputmode="search"
    enterkeyhint="search"
  />

  <mat-icon
    class="search-icon"
    svgIcon="search"
    aria-hidden="true"
    *ngIf="!searchTerm()"
  ></mat-icon>
  <mat-icon
    class="clear-search-icon"
    svgIcon="close"
    aria-hidden="true"
    *ngIf="searchTerm()"
    (click)="setSearch('')"
  ></mat-icon>
</div>

<!-- FILTERS (accordion) — TUTTE LE PAGINE, SOLO LETTERE -->
<div class="filters-accordion" [class.expanded]="isExpanded()">
  <div class="accordion-header" #filtersToggle (click)="toggleExpansion()">
    <h3 id="filtersTitle" class="accordion-title">
      <mat-icon
        class="accordion-icon"
        svgIcon="filter_list"
        aria-hidden="true"
      ></mat-icon>
      Filter Cocktails by Letter
    </h3>
    <span class="active-filters-summary" *ngIf="!isExpanded()">
      ({{ getActiveFiltersText() }})
    </span>
  </div>

  @defer (on interaction(filtersToggle); prefetch on idle) {
  <div
    class="accordion-content"
    id="filtersPanel"
    role="region"
    [attr.aria-labelledby]="'filtersTitle'"
  >
    <div class="letter-filter">
      <div
        class="letter-filter__chips"
        role="group"
        aria-label="Filter cocktails by first letter"
      >
        <!-- All -->
        <a
          role="button"
          [attr.href]="buildUrlWithParams({ letter: null, page: 1 })"
          class="chip"
          [class.active]="!selectedLetter()"
          (click)="$event.preventDefault(); onLetterChipClick($event, null)"
        >
          All
        </a>

        <!-- 0–9 -->
        <a
          [attr.href]="buildUrlWithParams({ letter: numberKey, page: 1 })"
          class="chip"
          [class.active]="selectedLetter() === numberKey"
          [class.disabled]="
            letterAvailabilityLoaded && !availableLetters.has(numberKey)
          "
          (click)="
            $event.preventDefault(); onLetterChipClick($event, numberKey)
          "
          [attr.aria-pressed]="selectedLetter() === numberKey"
          [attr.aria-disabled]="
            letterAvailabilityLoaded && !availableLetters.has(numberKey)
          "
          [attr.tabindex]="
            letterAvailabilityLoaded && !availableLetters.has(numberKey)
              ? -1
              : null
          "
          aria-label="Filter by number"
        >
          0–9
        </a>

        <!-- A–Z -->
        <ng-container *ngFor="let letter of letters">
          <a
            [attr.href]="buildUrlWithParams({ letter: letter, page: 1 })"
            class="chip"
            [class.active]="selectedLetter() === letter"
            [class.disabled]="
              letterAvailabilityLoaded && !availableLetters.has(letter)
            "
            (click)="$event.preventDefault(); onLetterChipClick($event, letter)"
            [attr.aria-pressed]="selectedLetter() === letter"
            [attr.aria-disabled]="
              letterAvailabilityLoaded && !availableLetters.has(letter)
            "
            [attr.tabindex]="
              letterAvailabilityLoaded && !availableLetters.has(letter)
                ? -1
                : null
            "
            [attr.aria-label]="'Filter by letter ' + letter"
          >
            {{ letter }}
          </a>
        </ng-container>
      </div>
    </div>
  </div>
  } @placeholder {
  <div class="accordion-content placeholder" aria-hidden="true"></div>
  }
</div>

<!-- STATUS ALERT (green, bouncing arrows) -->
<div
  *ngIf="!error"
  class="results-alert success bouncy"
  role="status"
  aria-live="polite"
>
  <ng-container *ngIf="loading; else countsLoadedCL">
    <mat-icon
      class="status-icon spinner"
      svgIcon="search"
      aria-hidden="true"
    ></mat-icon>
    <span>Searching cocktails…</span>
  </ng-container>

  <ng-template #countsLoadedCL>
    <div class="arrows" aria-hidden="true">
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
    </div>

    <span class="status-text">
      <b>{{ totalItems }}</b>
      {{ totalItems === 1 ? "cocktail" : "cocktails" }} found<br />
      <ng-container *ngIf="getActiveFiltersText() !== 'No filters active'">
        filters: <b>{{ getActiveFiltersText() }}</b>
      </ng-container>
    </span>

    <div class="arrows" aria-hidden="true">
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
      <mat-icon svgIcon="arrow_drop_down"></mat-icon>
    </div>
  </ng-template>
</div>

<hr />

<!-- Legenda migliorata con sinonimi e invito all’azione -->
<p class="cocktail-card-legend">
  Each card shows the cocktail’s <b>image</b>, <b>category</b>, estimated
  <b>ABV (Alcohol By Volume)</b>, <b>key ingredients</b>, and the
  <b>recommended glass</b>. Click any cocktail to view the full recipe, method,
  and ingredient links — an easy way to navigate classic and modern mixed
  drinks.
</p>

<div *ngIf="loading" class="loading-message">Loading cocktails...</div>
<div *ngIf="error" class="error-message">{{ error }}</div>

<!-- STATUS PAGINA / RISULTATI -->
<div
  class="page-status"
  *ngIf="!loading && !error && totalItems > 0"
  role="status"
  aria-live="polite"
>
  <span class="page-status__page"
    >Page {{ currentPage }} of {{ totalPages }}</span
  >
  <span class="page-status__sep" aria-hidden="true">•</span>
  <span class="page-status__range">
    Showing {{ pageStart }}–{{ pageEnd }} of {{ totalItems }}
  </span>
</div>

<!-- Skeleton quando loading -->
<div
  class="page-status page-status--skeleton"
  *ngIf="loading"
  aria-hidden="true"
>
  <span class="skl w-28"></span>
  <span class="skl w-6"></span>
  <span class="skl w-48"></span>
</div>

<div
  class="glass-card cards-grid limit-4"
  *ngIf="!error && cocktails.length > 0"
>
  <ng-container
    *ngFor="
      let cocktail of cocktails;
      let i = index;
      trackBy: trackByCocktailId
    "
  >
    <app-cocktail-card
      [cocktail]="cocktail"
      [isLcp]="i === 0"
      [activeVariant]="activeVariant"
      [activeSlug]="activeSlug"
    ></app-cocktail-card>

    <!-- Banner ogni 6 card (rimasto identico nella logica) -->
    <ng-container *ngIf="i > 0 && (i + 1) % 6 === 0">
      @defer (on viewport) {
      <section
        class="ad-block"
        role="complementary"
        aria-label="Sponsored content"
      >
        <span class="ad-badge">Ad</span>
        <app-dev-ads
          [type]="isMobile ? 'responsive' : 'small-square'"
        ></app-dev-ads>
      </section>
      } @placeholder {
      <section
        class="ad-block"
        role="complementary"
        aria-label="Sponsored content"
        aria-hidden="true"
      >
        <span class="ad-badge">Ad</span>
        <app-dev-ads
          [type]="isMobile ? 'responsive' : 'small-square'"
        ></app-dev-ads>
      </section>
      }
    </ng-container>
  </ng-container>
</div>

<div class="no-results-message" *ngIf="!loading && !cocktails.length">
  <p>No cocktails match your criteria. Try adjusting your filters!</p>
</div>

<div class="pagination-container" *ngIf="!loading && totalPages > 1">
  <div class="pagination-controls">
    <!-- Prev -->
    <ng-container *ngIf="currentPage > 1; else prevDisabled">
      <a
        [attr.href]="buildUrlWithParams({ page: currentPage - 1 })"
        class="page-number nav-arrow"
        aria-label="Go to previous page"
        (click)="$event.preventDefault(); goToPage(currentPage - 1)"
      >
        <mat-icon aria-hidden="true">chevron_left</mat-icon>
      </a>
    </ng-container>
    <ng-template #prevDisabled>
      <button
        type="button"
        class="page-number nav-arrow"
        aria-label="Previous page"
        disabled
      >
        <mat-icon aria-hidden="true">chevron_left</mat-icon>
      </button>
    </ng-template>

    <!-- Pagine -->
    <div class="page-numbers" role="navigation" aria-label="Pagination">
      <ng-container *ngIf="totalPages > 1">
        <span
          *ngIf="currentPage === 1"
          class="page-number active"
          aria-current="page"
          >1</span
        >
        <a
          *ngIf="currentPage !== 1"
          [attr.href]="buildUrlWithParams({ page: 1 })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(1)"
          >1</a
        >
      </ng-container>

      <span *ngIf="showFirstEllipsis()" class="ellipsis" aria-hidden="true"
        >…</span
      >

      <ng-container *ngFor="let page of getVisiblePages()">
        <span
          *ngIf="page === currentPage"
          class="page-number active"
          aria-current="page"
          >{{ page }}</span
        >
        <a
          *ngIf="page !== currentPage"
          [attr.href]="buildUrlWithParams({ page: page })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(page)"
          >{{ page }}</a
        >
      </ng-container>

      <span *ngIf="showLastEllipsis()" class="ellipsis" aria-hidden="true"
        >…</span
      >

      <ng-container *ngIf="totalPages > 1">
        <span
          *ngIf="currentPage === totalPages"
          class="page-number active"
          aria-current="page"
          >{{ totalPages }}</span
        >
        <a
          *ngIf="currentPage !== totalPages"
          [attr.href]="buildUrlWithParams({ page: totalPages })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(totalPages)"
          >{{ totalPages }}</a
        >
      </ng-container>
    </div>

    <!-- Next -->
    <ng-container *ngIf="currentPage < totalPages; else nextDisabled">
      <a
        [attr.href]="buildUrlWithParams({ page: currentPage + 1 })"
        class="page-number nav-arrow"
        aria-label="Go to next page"
        (click)="$event.preventDefault(); goToPage(currentPage + 1)"
      >
        <mat-icon aria-hidden="true">chevron_right</mat-icon>
      </a>
    </ng-container>
    <ng-template #nextDisabled>
      <button
        type="button"
        class="page-number nav-arrow"
        aria-label="Next page"
        disabled
      >
        <mat-icon aria-hidden="true">chevron_right</mat-icon>
      </button>
    </ng-template>
  </div>
</div>

<!-- Key features: confermato. Testo già segmentato e indicizzabile. -->
<div class="key-features-section" *ngIf="keyFeatures.length">
  <h3>{{ keyFeaturesHeading }}</h3>

  <div
    class="feature-item"
    *ngFor="let feature of keyFeatures; trackBy: trackByIndex"
  >
    <span class="feature-icon" aria-hidden="true">{{ feature.icon }}</span>
    <div class="feature-copy">
      <h4 class="feature-title">{{ feature.title }}</h4>
      <p class="feature-description">
        <ng-container *ngFor="let segment of feature.segments">
          <ng-container *ngIf="segment.kind === 'text'">
            <span
              [style.font-weight]="segment.emphasis === 'strong' ? '600' : null"
              >{{ segment.value }}</span
            >
          </ng-container>
          <ng-container *ngIf="segment.kind === 'routerLink'">
            <a
              [routerLink]="segment.commands"
              [queryParams]="segment.queryParams || undefined"
              [fragment]="segment.fragment || undefined"
            >
              <span
                [style.font-weight]="
                  segment.emphasis === 'strong' ? '600' : null
                "
                >{{ segment.label }}</span
              >
            </a>
          </ng-container>
          <ng-container *ngIf="segment.kind === 'externalLink'">
            <a
              [attr.href]="segment.href"
              [attr.target]="segment.target || null"
              [attr.rel]="segment.rel || null"
            >
              <span
                [style.font-weight]="
                  segment.emphasis === 'strong' ? '600' : null
                "
                >{{ segment.label }}</span
              >
            </a>
          </ng-container>
        </ng-container>
      </p>
    </div>
  </div>
</div>

@defer (on viewport) {
<div class="bottom-container">
  <div class="faq-section" *ngIf="faqEntries.length">
    <h2>{{ faqHeading }}</h2>

    <!-- SEO: breve prefazione alle FAQ, generica ma utile per tutte le sezioni -->
    <p class="faq-lead">
      Quick answers to common questions about this collection — definitions,
      serving tips, and how these cocktails relate to method, glass, and flavor
      families across Fizzando.
    </p>

    <div
      class="faq-item"
      *ngFor="let faq of faqEntries; let i = index; trackBy: trackByIndex"
      [class.expanded]="faqStates[i].isExpanded"
    >
      <button
        class="faq-question"
        type="button"
        [attr.id]="'faq-q-' + i"
        [attr.aria-controls]="'faq-a-' + i"
        [attr.aria-expanded]="faqStates[i].isExpanded"
      >
        <span>{{ faq.question }}</span>
        <mat-icon class="faq-toggle-icon" svgIcon="arrow_drop_down"></mat-icon>
      </button>

      <div
        #answer
        id="faq-a-{{ i }}"
        role="region"
        class="faq-answer-wrapper"
        [attr.aria-labelledby]="'faq-q-' + i"
        [style.maxHeight.px]="faqStates[i].isExpanded ? answer.scrollHeight : 0"
      >
        <p class="faq-answer">
          <ng-container *ngFor="let segment of faq.answer">
            <ng-container *ngIf="segment.kind === 'text'">
              <span
                [style.font-weight]="
                  segment.emphasis === 'strong' ? '600' : null
                "
                >{{ segment.value }}</span
              >
            </ng-container>
            <ng-container *ngIf="segment.kind === 'routerLink'">
              <a
                [routerLink]="segment.commands"
                [queryParams]="segment.queryParams || undefined"
                [fragment]="segment.fragment || undefined"
              >
                <span
                  [style.font-weight]="
                    segment.emphasis === 'strong' ? '600' : null
                  "
                  >{{ segment.label }}</span
                >
              </a>
            </ng-container>
            <ng-container *ngIf="segment.kind === 'externalLink'">
              <a
                [href]="segment.href"
                [attr.target]="segment.target || '_blank'"
                [attr.rel]="segment.rel || 'noopener noreferrer'"
              >
                <span
                  [style.font-weight]="
                    segment.emphasis === 'strong' ? '600' : null
                  "
                  >{{ segment.label }}</span
                >
              </a>
            </ng-container>
          </ng-container>
        </p>
      </div>
    </div>
  </div>

  @defer (on viewport) {
  <section class="ad-block" role="complementary" aria-label="Sponsored content">
    <span class="ad-badge">Ad</span>
    <app-dev-ads [type]="isMobile ? 'responsive' : 'half-page'"></app-dev-ads>
  </section>
  } @placeholder {
  <section
    class="ad-block"
    role="complementary"
    aria-label="Sponsored content"
    aria-hidden="true"
  >
    <span class="ad-badge">Ad</span>
    <app-dev-ads [type]="isMobile ? 'responsive' : 'half-page'"></app-dev-ads>
  </section>
  }
</div>
} @placeholder {
<div class="bottom-container placeholder" aria-hidden="true">
  <div class="faq-section skeleton"></div>
</div>
}
