<div class="dashboard-container">
  <div *ngIf="loading" class="loading-message">
    <p>Loading dashboard data…</p>
  </div>

  <div *ngIf="error" class="error-message">
    <mat-icon>error_outline</mat-icon>
    <p>{{ error }}</p>
    <button class="glass-button primary" (click)="ngOnInit()">Retry</button>
  </div>

  <div *ngIf="!loading && !error" class="dashboard-content">
    <!-- HERO (2/3) - testo = LCP (niente immagini qui) -->
    <section class="hero-section glass-card">
      <div class="hero-text">
        <h2>Welcome to FIZZANDO</h2>

        <p>
          Fizzando is your modern companion for discovering, learning, and
          mixing great drinks. From timeless classics to fresh signatures, we
          break recipes down with clear ratios, tested tips, and bar-ready
          technique so you can make better cocktails at home or behind the
          stick.
        </p>

        <p>
          Explore an ever-growing library of cocktails, deep ingredient
          profiles, step-by-step tutorials, and practical buying advice. Filter
          by base spirit, style, difficulty, or occasion; save favorites; and
          sharpen your knowledge with in-depth articles.
        </p>

        <ul class="hero-links">
          <li>
            <a [routerLink]="['/cocktails']">Cocktails</a> — browse recipes by
            spirit, style, or technique
          </li>
          <li>
            <a [routerLink]="['/ingredients']">Ingredients</a> — understand
            spirits, liqueurs, syrups, bitters, and more
          </li>
          <li>
            <a [routerLink]="['/articles']">Articles &amp; Guides</a> — history,
            methods, tools, and bar science
          </li>
        </ul>

        <button class="glass-button primary" [routerLink]="['/cocktails']">
          Browse all Cocktails <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
    </section>

    <!-- RANDOM (1/3) - immagine lazy, srcset/sizes -->
    <section class="random-cocktail-section glass-card" *ngIf="randomCocktail">
      <h3>Your Random Cocktail</h3>
      <div class="cocktail-display">
        <img
          [ngSrc]="getBestImageUrl(randomCocktail?.image, 360)"
          [srcset]="getImageSrcSet(randomCocktail?.image) || null"
          sizes="(max-width: 768px) 90vw, 360px"
          [alt]="randomCocktail?.name || 'Random cocktail'"
          class="random-cocktail-image"
          width="360"
          height="360"
          loading="lazy"
          decoding="async"
          fetchpriority="low"
        />
        <h4>{{ randomCocktail.name }}</h4>
        <p class="cocktail-category">{{ randomCocktail.category }}</p>
        <button
          class="glass-button secondary"
          [routerLink]="['/cocktails', randomCocktail.slug]"
        >
          View Recipe <mat-icon>visibility</mat-icon>
        </button>
      </div>
    </section>

    <!-- AD #1 (defer on viewport) -->
    @defer (on viewport) {
    <section class="ad-block">
      <ng-container>
        <div
          *ngIf="isMobile"
          class="mobile-ad-container"
          role="complementary"
          aria-label="Sponsored content"
        >
          <span class="ad-badge">Ad</span>
          <app-dev-ads [type]="'mobile-banner'"></app-dev-ads>
        </div>

        <div
          class="ad-desktop-card"
          *ngIf="!isMobile"
          role="complementary"
          aria-label="Sponsored content"
        >
          <span class="ad-badge">Ad</span>
          <app-dev-ads [type]="'leaderboard'"></app-dev-ads>
        </div>
      </ng-container>
    </section>
    } @placeholder {
    <section class="ad-block ad-skeleton" aria-hidden="true"></section>
    }

    <!-- QUICK LINKS -->
    <section class="quick-links-section glass-card">
      <h3>Quick Explore</h3>
      <div class="links-grid">
        <button class="glass-button secondary" [routerLink]="['/cocktails']">
          <mat-icon>local_bar</mat-icon> All Cocktails
        </button>

        <button class="glass-button secondary" [routerLink]="['/ingredients']">
          <mat-icon>science</mat-icon> All Ingredients
        </button>

        <button class="glass-button secondary" [routerLink]="['/articles']">
          <mat-icon>article</mat-icon> All Articles
        </button>

        <button
          class="glass-button secondary"
          [routerLink]="['/find-by-ingredients']"
        >
          <mat-icon>search</mat-icon> Find by Ingredients
        </button>

        <button
          class="glass-button secondary"
          [routerLink]="['/cocktails']"
          [queryParams]="{ alcoholic: 'Alcoholic' }"
        >
          <mat-icon>liquor</mat-icon> Alcoholic
        </button>

        <button
          class="glass-button secondary"
          [routerLink]="['/cocktails']"
          [queryParams]="{ alcoholic: 'Non Alcoholic' }"
        >
          <mat-icon>local_drink</mat-icon> Non-Alcoholic
        </button>
      </div>

      <div class="category-chips" *ngIf="topCocktailCategories.length">
        <span class="chip-label">Popular categories:</span>
        <a
          class="chip"
          *ngFor="let cat of topCocktailCategories; trackBy: trackByString"
          [routerLink]="['/cocktails']"
          [queryParams]="{ search: cat }"
        >
          {{ cat }}
        </a>
      </div>
    </section>

    <!-- FEATURED COCKTAILS -->
    <section class="section-block glass-card" *ngIf="featuredCocktails.length">
      <div class="section-head">
        <h3>Featured Cocktails</h3>
        <a class="link-inline" [routerLink]="['/cocktails']">View all</a>
      </div>
      <div class="cards-grid limit-4">
        <app-cocktail-card
          *ngFor="
            let c of featuredCocktails | slice : 0 : 8;
            trackBy: trackByCocktail
          "
          [cocktail]="c"
        ></app-cocktail-card>
      </div>
    </section>

    <!-- AD #2 (defer on viewport) -->
    @defer (on viewport) {
    <section class="ad-block">
      <ng-container>
        <div
          *ngIf="isMobile"
          class="mobile-ad-container"
          role="complementary"
          aria-label="Sponsored content"
        >
          <span class="ad-badge">Ad</span>
          <app-dev-ads [type]="'mobile-banner'"></app-dev-ads>
        </div>

        <div
          class="ad-desktop-card"
          *ngIf="!isMobile"
          role="complementary"
          aria-label="Sponsored content"
        >
          <span class="ad-badge">Ad</span>
          <app-dev-ads [type]="'leaderboard'"></app-dev-ads>
        </div>
      </ng-container>
    </section>
    } @placeholder {
    <section class="ad-block ad-skeleton" aria-hidden="true"></section>
    }

    <!-- LATEST INGREDIENTS (defer: viewport) -->
    @defer (on viewport) {
    <section class="section-block glass-card" *ngIf="latestIngredients.length">
      <div class="section-head">
        <h3>Latest Ingredients</h3>
        <a class="link-inline" [routerLink]="['/ingredients']">View all</a>
      </div>
      <div class="cards-grid limit-4">
        <app-ingredient-card
          *ngFor="let ing of latestIngredients; trackBy: trackByIngredient"
          [ingredient]="ing"
        ></app-ingredient-card>
      </div>
    </section>
    } @placeholder {
    <section
      class="section-block glass-card skeleton"
      aria-hidden="true"
    ></section>
    }

    <!-- LATEST ARTICLES (defer: idle) -->
    @defer (on idle) {
    <section class="section-block glass-card" *ngIf="latestArticles.length">
      <div class="section-head">
        <h3>Latest Articles</h3>
        <a class="link-inline" [routerLink]="['/articles']">View all</a>
      </div>
      <div class="cards-grid limit-4">
        <app-article-card
          *ngFor="let a of latestArticles; trackBy: trackByArticle"
          [article]="a"
          [priority]="false"
        ></app-article-card>
      </div>
    </section>
    } @placeholder {
    <section
      class="section-block glass-card skeleton"
      aria-hidden="true"
    ></section>
    }

    <!-- ARTICLES BY CATEGORY (defer: viewport) -->
    @defer (on viewport) {
    <section class="articles-by-category-section">
      <h3>Explore Articles by Category</h3>
      <div class="articles-category-grid">
        <div class="category-card glass-card">
          <h4>
            <a [routerLink]="['/articles/category', 'history']"
              >Cocktail History</a
            >
          </h4>
          <p>Discover the origins and evolution behind your favorite drinks.</p>
          <ul class="category-article-list">
            <li
              *ngFor="let article of historyArticles; trackBy: trackByArticle"
            >
              <a [routerLink]="['/articles', article.slug]">{{
                article.title
              }}</a>
            </li>
          </ul>
          <button
            class="glass-button secondary"
            [routerLink]="['/articles/category', 'history']"
          >
            View all <mat-icon>arrow_forward</mat-icon>
          </button>
        </div>

        <div class="category-card glass-card">
          <h4>
            <a [routerLink]="['/articles/category', 'techniques']"
              >Mixology Techniques</a
            >
          </h4>
          <p>
            Learn fundamentals and pro tips for consistently great cocktails.
          </p>
          <ul class="category-article-list">
            <li
              *ngFor="
                let article of techniquesArticles;
                trackBy: trackByArticle
              "
            >
              <a [routerLink]="['/articles', article.slug]">{{
                article.title
              }}</a>
            </li>
          </ul>
          <button
            class="glass-button secondary"
            [routerLink]="['/articles/category', 'techniques']"
          >
            View all <mat-icon>arrow_forward</mat-icon>
          </button>
        </div>

        <div class="category-card glass-card">
          <h4>
            <a [routerLink]="['/articles/category', 'ingredients']"
              >Ingredients 101</a
            >
          </h4>
          <p>Deep-dive into spirits, liqueurs, modifiers, syrups, and more.</p>
          <ul class="category-article-list">
            <li
              *ngFor="
                let article of ingredientsArticles;
                trackBy: trackByArticle
              "
            >
              <a [routerLink]="['/articles', article.slug]">{{
                article.title
              }}</a>
            </li>
          </ul>
          <button
            class="glass-button secondary"
            [routerLink]="['/articles/category', 'ingredients']"
          >
            View all <mat-icon>arrow_forward</mat-icon>
          </button>
        </div>
      </div>
    </section>
    } @placeholder {
    <section
      class="articles-by-category-section skeleton"
      aria-hidden="true"
    ></section>
    }
  </div>
</div>
