<header
  role="banner"
  class="app-header"
  appStickyHeader="fixed"
  [class.scrolled]="isScrolled"
>
  <div class="header-content">
    <app-logo (click)="closeMenu()"></app-logo>

    <div class="header-actions">
      <!-- Bottone SEARCH -->
      <button
        type="button"
        class="icon-button"
        (click)="toggleSearch()"
        [attr.aria-expanded]="isSearchOpen"
        aria-controls="search-overlay"
        aria-label="Search cocktail o ingredient"
      >
        <mat-icon aria-hidden="true">
          {{ isSearchOpen ? "close" : "search" }}
        </mat-icon>
      </button>

      <!-- Bottone MENU -->
      <button
        #menuToggle
        type="button"
        class="menu-toggle-button icon-button"
        (click)="toggleMenu()"
        [attr.aria-expanded]="isMenuOpen ? 'true' : 'false'"
        aria-controls="primary-navigation"
        [attr.aria-label]="isMenuOpen ? 'Close menu' : 'Open menu'"
        aria-haspopup="menu"
      >
        <mat-icon aria-hidden="true">
          {{ isMenuOpen ? "close" : "menu" }}
        </mat-icon>
      </button>
    </div>
  </div>
</header>

<!-- MENU OVERLAY (hamburger) -->
<div
  #overlayRoot
  class="full-screen-menu-overlay"
  role="dialog"
  aria-modal="true"
  aria-labelledby="menu-title"
  aria-describedby="menu-hint"
  [class.open]="isMenuOpen"
  (keydown.escape)="closeMenu()"
>
  <div class="overlay-content">
    <h2 id="menu-title" class="visually-hidden">Main menu</h2>

    <div class="overlay-breadcrumbs">
      <app-breadcrumbs (linkClicked)="closeMenu()"></app-breadcrumbs>
    </div>

    <!-- NIENTE ricerca qui dentro (rimossa) -->

    <nav id="primary-navigation" role="navigation" aria-label="Primary">
      <div class="menu-grid">
        <!-- Cocktails -->
        <div
          class="menu-card cocktails-card"
          role="region"
          aria-labelledby="nav-cocktails-title"
        >
          <h3 id="nav-cocktails-title">ğŸ¸ Cocktails</h3>

          <ul>
            <li>
              <a
                routerLink="/cocktails"
                [attr.href]="'/cocktails'"
                (click)="closeMenu()"
                >ğŸ¸ Cocktails Explorer</a
              >
            </li>
            <li>
              <a
                routerLink="/cocktails"
                [queryParams]="{ alcoholic: 'Alcoholic' }"
                [attr.href]="'/cocktails?alcoholic=Alcoholic'"
                (click)="closeMenu()"
                >ğŸ¥ƒ Alcoholic</a
              >
            </li>
            <li>
              <a
                routerLink="/cocktails"
                [queryParams]="{ alcoholic: 'Non Alcoholic' }"
                [attr.href]="'/cocktails?alcoholic=Non%20Alcoholic'"
                (click)="closeMenu()"
                >ğŸ’§ Non Alcoholic</a
              >
            </li>
          </ul>

          <h4 id="nav-cocktails-cat-title">Explore by Category</h4>
          <div
            class="filter-with-button"
            aria-describedby="nav-cocktails-cat-help"
          >
            <p id="nav-cocktails-cat-help" class="visually-hidden">
              Choose a cocktail category, then press Go.
            </p>

            <div class="custom-select-wrapper">
              <label class="visually-hidden" for="cocktail-category-select"
                >Cocktail category</label
              >
              <select
                id="cocktail-category-select"
                [(ngModel)]="selectedCocktailCategory"
                class="custom-select"
              >
                <option
                  value=""
                  [attr.selected]="
                    selectedCocktailCategory === '' ? true : null
                  "
                >
                  All Categories
                </option>
                <option value="classic">ğŸ§Š Classic</option>
                <option value="tropical">ğŸŒ´ Tropical</option>
                <option value="refreshing">ğŸƒ Refreshing</option>
                <option value="aperitif">ğŸ¥‚ Aperitif</option>
                <option value="after-dinner">ğŸŒ™ After-Dinner</option>
                <option value="sour">ğŸ‹ Sour</option>
                <option value="spirit-forward">ğŸ¥ƒ Spirit-Forward</option>
                <option value="sparkling">âœ¨ Sparkling</option>
                <option value="flaming">ğŸ”¥ Flaming</option>
                <option value="hot">â™¨ï¸ Hot</option>
                <option value="other">â“ Other</option>
              </select>
              <mat-icon class="select-arrow-icon" aria-hidden="true"
                >arrow_drop_down</mat-icon
              >
            </div>

            <button
              type="button"
              class="go-button glass-button secondary"
              [class.active]="
                selectedCocktailCategory !== '' &&
                selectedCocktailCategory !== activeCocktailCategoryInUrl
              "
              (click)="goCocktailCategory()"
              [attr.aria-label]="
                'Go to ' +
                (selectedCocktailCategory || 'All Categories') +
                ' cocktails'
              "
              aria-describedby="cocktail-category-select"
            >
              <mat-icon aria-hidden="true">arrow_forward</mat-icon>
            </button>
          </div>
        </div>

        <!-- Ingredients -->
        <div
          class="menu-card ingredients-card"
          role="region"
          aria-labelledby="nav-ingredients-title"
        >
          <h3 id="nav-ingredients-title">ğŸ‹ Ingredients</h3>

          <ul>
            <li>
              <a
                routerLink="/ingredients"
                [attr.href]="'/ingredients'"
                (click)="closeMenu()"
                >ğŸ¥• Ingredients Explorer</a
              >
            </li>
            <li>
              <a
                routerLink="/ingredients"
                [queryParams]="{ alcoholic: 'true' }"
                [attr.href]="'/ingredients?alcoholic=true'"
                (click)="closeMenu()"
                >ğŸ¥ƒ Alcoholic Ingredients</a
              >
            </li>
            <li>
              <a
                routerLink="/ingredients"
                [queryParams]="{ alcoholic: 'false' }"
                [attr.href]="'/ingredients?alcoholic=false'"
                (click)="closeMenu()"
                >ğŸ’§ Non-Alcoholic Ingredients</a
              >
            </li>
          </ul>

          <h4 id="nav-ingredients-type-title">Explore By Type</h4>
          <div
            class="filter-with-button"
            aria-describedby="nav-ingredients-type-help"
          >
            <p id="nav-ingredients-type-help" class="visually-hidden">
              Choose an ingredient type, then press Go.
            </p>

            <div class="custom-select-wrapper">
              <label class="visually-hidden" for="ingredient-type-select"
                >Ingredient type</label
              >
              <select
                id="ingredient-type-select"
                [(ngModel)]="selectedIngredientType"
                class="custom-select"
              >
                <option
                  value=""
                  [attr.selected]="selectedIngredientType === '' ? true : null"
                >
                  All Types
                </option>
                <option value="spirits">ğŸ¥ƒ Spirits</option>
                <option value="liqueurs-and-cordials">
                  ğŸ¯ Liqueurs &amp; Cordials
                </option>
                <option value="wines-and-fortified-wines">
                  ğŸ· Wines &amp; Fortified Wines
                </option>
                <option value="bitters">ğŸŒ¿ Bitters</option>
                <option value="syrups-and-sweeteners">
                  ğŸ¬ Syrups &amp; Sweeteners
                </option>
                <option value="citrus-juices">ğŸ‹ Citrus Juices</option>
                <option value="fruit-juices-non-citrus">
                  ğŸ Fruit Juices (Non-Citrus)
                </option>
                <option value="carbonated-mixers">ğŸ«§ Carbonated Mixers</option>
                <option value="non-carbonated-mixers">
                  ğŸ’§ Non-Carbonated Mixers
                </option>
                <option value="fresh-herbs-and-botanicals">
                  ğŸŒ± Fresh Herbs &amp; Botanicals
                </option>
                <option value="spices">ğŸŒ¶ï¸ Spices</option>
                <option value="fresh-fruits-solid-garnish">
                  ğŸ“ Fresh Fruits (Solid/Garnish)
                </option>
                <option value="vegetables-non-herb">
                  ğŸ¥• Vegetables (Non-Herb)
                </option>
                <option value="dairy-and-eggs">ğŸ¥› Dairy &amp; Eggs</option>
                <option value="other-extracts-and-flavorings">
                  ğŸ§ª Other Extracts &amp; Flavorings
                </option>
                <option value="salts-and-sugars-rimming-specialty">
                  ğŸ§‚ Salts &amp; Sugars (Rimming/Specialty)
                </option>
                <option value="miscellaneous">âœ¨ Miscellaneous</option>
              </select>
              <mat-icon class="select-arrow-icon" aria-hidden="true"
                >arrow_drop_down</mat-icon
              >
            </div>

            <button
              type="button"
              class="go-button glass-button secondary"
              [class.active]="
                selectedIngredientType !== '' &&
                selectedIngredientType !== activeIngredientTypeInUrl
              "
              (click)="goIngredientType()"
              [attr.aria-label]="
                'Go to ' +
                (selectedIngredientType || 'All Types') +
                ' ingredients'
              "
              aria-describedby="ingredient-type-select"
            >
              <mat-icon aria-hidden="true">arrow_forward</mat-icon>
            </button>
          </div>
        </div>

        <!-- Find by Ingredients -->
        <div
          class="menu-card my-recipes-card"
          role="region"
          aria-labelledby="nav-find-title"
        >
          <h3 id="nav-find-title">ğŸ¸ + ğŸ‹ Find Your Cocktail</h3>
          <ul>
            <li>
              <a
                routerLink="/find-cocktail"
                [attr.href]="'/find-cocktail'"
                (click)="closeMenu()"
                >ğŸŒ¿ Search by Ingredients</a
              >
            </li>
          </ul>
        </div>

        <!-- Glossary -->
        <div
          class="menu-card glossary-card"
          role="region"
          aria-labelledby="nav-glossary-title"
        >
          <h3 id="nav-glossary-title">ğŸ“˜ Glossary</h3>
          <ul>
            <li>
              <a
                routerLink="/glossary"
                [attr.href]="'/glossary'"
                (click)="closeMenu()"
                >ğŸ“˜ Cocktail Glossary</a
              >
            </li>
          </ul>

          <h4 id="nav-glossary-cat-title">Explore by Category</h4>
          <div
            class="filter-with-button"
            aria-describedby="nav-glossary-cat-help"
          >
            <p id="nav-glossary-cat-help" class="visually-hidden">
              Choose a glossary category, then press Go.
            </p>

            <div class="custom-select-wrapper">
              <label class="visually-hidden" for="glossary-category-select"
                >Glossary category</label
              >
              <select
                id="glossary-category-select"
                [(ngModel)]="selectedGlossaryCategory"
                class="custom-select"
              >
                <option
                  value=""
                  [attr.selected]="
                    selectedGlossaryCategory === '' ? true : null
                  "
                >
                  All Categories
                </option>
                <option *ngFor="let cat of glossaryCategories" [value]="cat">
                  {{ cat }}
                </option>
              </select>
              <mat-icon class="select-arrow-icon" aria-hidden="true"
                >arrow_drop_down</mat-icon
              >
            </div>

            <button
              type="button"
              class="go-button glass-button secondary"
              [class.active]="
                selectedGlossaryCategory !== '' &&
                selectedGlossaryCategory !== activeGlossaryCategoryInUrl
              "
              (click)="goGlossaryCategory()"
              [attr.aria-label]="
                'Go to ' +
                (selectedGlossaryCategory || 'All Categories') +
                ' glossary terms'
              "
              aria-describedby="glossary-category-select"
            >
              <mat-icon aria-hidden="true">arrow_forward</mat-icon>
            </button>
          </div>
        </div>

        <!-- Home -->
        <div
          class="menu-card home-card"
          role="region"
          aria-labelledby="nav-home-title"
        >
          <h3 id="nav-home-title">ğŸ  Home</h3>
          <ul>
            <li>
              <a routerLink="/" [attr.href]="'/'" (click)="closeMenu()"
                >ğŸ  Go to Homepage</a
              >
            </li>
            <li>
              <a
                routerLink="/about"
                [attr.href]="'/about'"
                (click)="closeMenu()"
                >â„¹ï¸ About Us</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </div>
</div>

<!-- SEARCH OVERLAY (nuovo, solo cocktail & ingredienti) -->
<div
  #searchOverlayRoot
  id="search-overlay"
  class="search-overlay"
  role="dialog"
  aria-modal="true"
  aria-labelledby="search-title"
  [class.open]="isSearchOpen"
  (keydown.escape)="closeSearch()"
  (click)="closeSearch()"
>
  <div class="search-overlay__content" (click)="$event.stopPropagation()">
    <h2 id="search-title" class="visually-hidden">Site search</h2>

    <div class="overlay-search-section">
      <!-- Landmark corretto -->
      <div
        class="search-input-container"
        role="search"
        aria-label="Site search"
      >
        <label class="visually-hidden" for="overlay-search-input"
          >Search site</label
        >

        <input
          #overlaySearchInput
          id="overlay-search-input"
          type="text"
          placeholder="Find cocktail or ingredient..."
          class="overlay-search-input"
          [(ngModel)]="overlaySearchTerm"
          (input)="onSearchTermChange()"
          (focus)="onSearchInputFocus()"
          (blur)="onSearchInputBlur()"
          [class.has-value]="overlaySearchTerm.length > 0"
          aria-controls="live-search-results"
          [attr.aria-expanded]="
            isSearchInputFocused && overlaySearchTerm.length >= 3
              ? 'true'
              : 'false'
          "
          aria-describedby="search-help"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          inputmode="search"
          enterkeyhint="search"
        />

        <!-- help test per SR -->
        <span id="search-help" class="visually-hidden">
          Start typing at least 3 characters to see results below.
        </span>

        <button
          *ngIf="overlaySearchTerm.length > 0"
          type="button"
          class="clear-search-button"
          (click)="clearSearchTerm($event)"
          aria-label="Clear search"
        >
          <mat-icon aria-hidden="true">close</mat-icon>
        </button>
      </div>
    </div>

    <!-- Contenitore risultati: live region + aria-busy -->
    <div
      id="live-search-results"
      class="live-search-results"
      [attr.aria-live]="'polite'"
      [attr.aria-relevant]="'additions'"
      [attr.aria-busy]="liveSearchLoading ? 'true' : 'false'"
      *ngIf="overlaySearchTerm.length >= 3"
    >
      <!-- Stato: caricamento -->
      <div
        *ngIf="liveSearchLoading"
        class="loading-message"
        role="status"
        aria-live="polite"
      >
        Caricamento risultati...
      </div>

      <!-- Stato: risultati presenti -->
      <div
        *ngIf="
          !liveSearchLoading &&
          (liveCocktailResults.length || liveIngredientResults.length)
        "
      >
        <!-- Cocktails -->
        <div
          class="results-group"
          role="region"
          [attr.aria-labelledby]="'results-cocktails-title'"
          *ngIf="liveCocktailResults.length"
        >
          <h4 id="results-cocktails-title" class="group-title">
            ğŸ¸ Cocktails ({{ liveCocktailResults.length }})
          </h4>
          <ul role="list">
            <li *ngFor="let cocktail of liveCocktailResults" role="listitem">
              <a
                [routerLink]="['/cocktails', cocktail.slug]"
                [attr.href]="'/cocktails/' + cocktail.slug"
                (click)="closeSearch()"
              >
                <img
                  *ngIf="cocktail.image?.formats?.thumbnail?.url"
                  [src]="cocktail.image?.formats?.thumbnail?.url"
                  [alt]="cocktail.name"
                  class="img-cocktail"
                  width="30"
                  height="30"
                  loading="lazy"
                  decoding="async"
                />
                {{ cocktail.name }}
              </a>
            </li>
          </ul>
        </div>

        <!-- Ingredients -->
        <div
          class="results-group"
          role="region"
          [attr.aria-labelledby]="'results-ingredients-title'"
          *ngIf="liveIngredientResults.length"
        >
          <h4 id="results-ingredients-title" class="group-title">
            ğŸ‹ Ingredients ({{ liveIngredientResults.length }})
          </h4>
          <ul role="list">
            <li
              *ngFor="let ingredient of liveIngredientResults"
              role="listitem"
            >
              <a
                [routerLink]="['/ingredients', ingredient.external_id]"
                [attr.href]="'/ingredients/' + ingredient.external_id"
                (click)="closeSearch()"
              >
                <img
                  *ngIf="ingredient.image?.url"
                  [src]="ingredient.image?.url"
                  [alt]="ingredient.name"
                  class="img-ingredient"
                  width="30"
                  height="30"
                  loading="lazy"
                  decoding="async"
                />
                {{ ingredient.name }}
              </a>
            </li>
          </ul>
        </div>
      </div>

      <!-- Stato: nessun risultato -->
      <div
        *ngIf="
          !liveSearchLoading &&
          overlaySearchTerm.length >= 3 &&
          !liveCocktailResults.length &&
          !liveIngredientResults.length
        "
        class="no-results-message"
        role="status"
        aria-live="polite"
      >
        No results found for "{{ overlaySearchTerm }}"
      </div>
    </div>
  </div>
</div>
