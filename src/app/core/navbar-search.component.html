<div
  #overlayRoot
  id="search-overlay"
  class="search-overlay"
  role="dialog"
  aria-modal="true"
  aria-labelledby="search-title"
  [class.open]="open"
  (keydown.escape)="requestClose()"
  (click)="requestClose()"
>
  <div class="search-overlay__content" (click)="$event.stopPropagation()">
    <h2 id="search-title" class="visually-hidden">Site search</h2>

    <div class="overlay-search-section">
      <div
        class="search-input-container"
        role="search"
        aria-label="Site search"
      >
        <label class="visually-hidden" for="overlay-search-input"
          >Search site</label
        >

        <input
          #overlaySearchInput
          id="overlay-search-input"
          type="text"
          placeholder="Find cocktail or ingredient..."
          class="overlay-search-input"
          [(ngModel)]="overlaySearchTerm"
          (input)="onSearchTermChange()"
          (focus)="onSearchInputFocus()"
          (blur)="onSearchInputBlur()"
          [class.has-value]="overlaySearchTerm.length > 0"
          aria-controls="live-search-results"
          [attr.aria-expanded]="
            isSearchInputFocused && overlaySearchTerm.length >= 3
              ? 'true'
              : 'false'
          "
          aria-describedby="search-help"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          inputmode="search"
          enterkeyhint="search"
        />

        <span id="search-help" class="visually-hidden">
          Start typing at least 3 characters to see results below.
        </span>

        <button
          *ngIf="overlaySearchTerm.length > 0"
          type="button"
          class="clear-search-button"
          (click)="clearSearchTerm($event)"
          aria-label="Clear search"
        >
          <mat-icon aria-hidden="true">close</mat-icon>
        </button>
      </div>
    </div>

    <div
      id="live-search-results"
      class="live-search-results"
      [attr.aria-live]="'polite'"
      [attr.aria-relevant]="'additions'"
      [attr.aria-busy]="liveSearchLoading ? 'true' : 'false'"
      *ngIf="overlaySearchTerm.length >= 3"
    >
      <div
        *ngIf="liveSearchLoading"
        class="loading-message"
        role="status"
        aria-live="polite"
      >
        Caricamento risultati...
      </div>

      <div
        *ngIf="
          !liveSearchLoading &&
          (liveCocktailResults.length || liveIngredientResults.length)
        "
      >
        <div
          class="results-group"
          role="region"
          [attr.aria-labelledby]="'results-cocktails-title'"
          *ngIf="liveCocktailResults.length"
        >
          <h4 id="results-cocktails-title" class="group-title">
            üç∏ Cocktails ({{ liveCocktailResults.length }})
          </h4>
          <ul role="list">
            <li *ngFor="let cocktail of liveCocktailResults" role="listitem">
              <a
                [routerLink]="['/cocktails', cocktail.slug]"
                [attr.href]="'/cocktails/' + cocktail.slug"
                (click)="requestClose()"
              >
                <img
                  *ngIf="cocktail.image?.formats?.thumbnail?.url"
                  [src]="cocktail.image?.formats?.thumbnail?.url"
                  [alt]="cocktail.name"
                  class="img-cocktail"
                  width="30"
                  height="30"
                  loading="lazy"
                  decoding="async"
                />
                {{ cocktail.name }}
              </a>
            </li>
          </ul>
        </div>

        <div
          class="results-group"
          role="region"
          [attr.aria-labelledby]="'results-ingredients-title'"
          *ngIf="liveIngredientResults.length"
        >
          <h4 id="results-ingredients-title" class="group-title">
            üçã Ingredients ({{ liveIngredientResults.length }})
          </h4>
          <ul role="list">
            <li
              *ngFor="let ingredient of liveIngredientResults"
              role="listitem"
            >
              <a
                [routerLink]="['/ingredients', ingredient.external_id]"
                [attr.href]="'/ingredients/' + ingredient.external_id"
                (click)="requestClose()"
              >
                <img
                  *ngIf="ingredient.image?.url"
                  [src]="ingredient.image?.url"
                  [alt]="ingredient.name"
                  class="img-ingredient"
                  width="30"
                  height="30"
                  loading="lazy"
                  decoding="async"
                />
                {{ ingredient.name }}
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div
        *ngIf="
          !liveSearchLoading &&
          !liveCocktailResults.length &&
          !liveIngredientResults.length
        "
        class="no-results"
        role="status"
        aria-live="polite"
      >
        No results found for "{{ overlaySearchTerm }}"
      </div>
    </div>
  </div>
</div>
