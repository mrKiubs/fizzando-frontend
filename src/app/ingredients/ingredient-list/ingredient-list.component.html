<div class="page-header-container" [class.fonts-loaded]="fontsLoaded">
  <h1>Ingredient Explorer</h1>
  <h2>Search, Filter, and Learn About Cocktail Ingredients</h2>

  <p class="page-subtitle">
    Explore our <b>comprehensive ingredient archive</b>: spirits, liqueurs,
    mixers, juices, syrups, herbs, and more. Use the <b>smart filters</b> to
    find what you need.
  </p>
</div>

<!-- SEARCH (senza FormsModule, come CocktailList) -->
<div class="custom-search-input-wrapper">
  <input
    type="search"
    class="custom-search-input"
    placeholder="Search ingredient by name..."
    [value]="searchTerm()"
    (input)="onSearchInput($event)"
    aria-label="Search ingredient by name"
  />
  <mat-icon
    class="search-icon"
    svgIcon="search"
    aria-hidden="true"
    *ngIf="!searchTerm()"
  ></mat-icon>
  <mat-icon
    class="clear-search-icon"
    svgIcon="close"
    aria-hidden="true"
    *ngIf="searchTerm()"
    (click)="clearFilters(); setSearch('')"
  ></mat-icon>
</div>

<!-- FILTERS con @defer e chiusura con *ngIf (uniforme) -->
<div class="filters-accordion" [class.expanded]="isExpanded()">
  <div class="accordion-header" #filtersToggle (click)="toggleExpansion()">
    <h3 class="accordion-title">
      <mat-icon
        class="accordion-icon"
        svgIcon="filter_list"
        aria-hidden="true"
      ></mat-icon>
      Filters
    </h3>
    <span class="active-filters-summary" *ngIf="!isExpanded()">
      ({{ getActiveFiltersText() }})
    </span>
  </div>

  @defer (on interaction(filtersToggle); prefetch on idle) {
  <div class="accordion-content" *ngIf="isExpanded()">
    <div class="filter-group">
      <label for="alcoholic-select" class="filter-label"
        >Alcoholic / Non-Alcoholic</label
      >
      <div class="custom-select-wrapper">
        <select
          id="alcoholic-select"
          class="custom-select"
          [value]="
            selectedAlcoholic() === 'true'
              ? 'Alcoholic'
              : selectedAlcoholic() === 'false'
              ? 'Non-Alcoholic'
              : ''
          "
          (change)="setAlcoholicUi($any($event.target).value)"
          (click)="$event.stopPropagation()"
          aria-label="Filter by alcoholic content"
        >
          <option value="">All</option>
          <option *ngFor="let option of alcoholicOptions" [value]="option">
            {{ option }}
          </option>
        </select>
        <mat-icon
          class="select-arrow-icon"
          svgIcon="arrow_drop_down"
          aria-hidden="true"
        ></mat-icon>
      </div>
    </div>

    <div class="filter-group">
      <label for="type-select" class="filter-label">Ingredient Type</label>
      <div class="custom-select-wrapper">
        <select
          id="type-select"
          class="custom-select"
          [value]="selectedType()"
          (change)="setType($any($event.target).value)"
          (click)="$event.stopPropagation()"
          aria-label="Filter by ingredient type"
        >
          <option value="">All Types</option>
          <option *ngFor="let t of ingredientTypes" [value]="t">{{ t }}</option>
        </select>
        <mat-icon
          class="select-arrow-icon"
          svgIcon="arrow_drop_down"
          aria-hidden="true"
        ></mat-icon>
      </div>
    </div>

    <div class="filter-group filter-button-row">
      <button
        class="glass-button secondary"
        (click)="clearFilters()"
        aria-label="Clear all filters"
      >
        <mat-icon svgIcon="clear_all" aria-hidden="true"></mat-icon>
        Clear Filters
      </button>
    </div>
  </div>
  } @placeholder {
  <div class="accordion-content placeholder" aria-hidden="true"></div>
  }
</div>

<hr />

<p class="ingredient-card-legend">
  Each card shows the ingredient <b>image</b> and whether it's
  <b>alcoholic</b> or <b>non-alcoholic</b>. Click an ingredient to view full
  details!
</p>

<div *ngIf="loading" class="loading-message">Loading ingredients...</div>
<div *ngIf="error" class="error-message">{{ error }}</div>

<!-- STATUS PAGINA / RISULTATI (come CocktailList) -->
<div
  class="page-status"
  *ngIf="!loading && !error && totalItems > 0"
  role="status"
  aria-live="polite"
>
  <span class="page-status__page"
    >Page {{ currentPage }} of {{ totalPages }}</span
  >
  <span class="page-status__sep" aria-hidden="true">‚Ä¢</span>
  <span class="page-status__range">
    Showing {{ pageStart }}‚Äì{{ pageEnd }} of {{ totalItems }}
  </span>
</div>

<!-- Skeleton quando loading -->
<div
  class="page-status page-status--skeleton"
  *ngIf="loading"
  aria-hidden="true"
>
  <span class="skl w-28"></span>
  <span class="skl w-6"></span>
  <span class="skl w-48"></span>
</div>

<!-- GRID (riuso classi .cocktail-list se gi√† stilate) -->
<div class="cocktail-list" *ngIf="!error && ingredients.length > 0">
  <ng-container
    *ngFor="let ingredient of ingredients; let i = index; trackBy: trackById"
  >
    <app-ingredient-card
      [ingredient]="ingredient"
      [lazyLoadImage]="i >= 6"
      [priority]="isMobile && i === 0"
    ></app-ingredient-card>

    <!-- slot adv ogni 6 card -->
    <ng-container *ngIf="i > 0 && (i + 1) % adInterval === 0">
      <div
        *ngIf="isMobile"
        class="mobile-ad-container ingredients-card"
        role="complementary"
        aria-label="Sponsored content"
      >
        <span class="ad-badge">Ad</span>
        <app-dev-ads [type]="'mobile-banner'"></app-dev-ads>
      </div>

      <div
        class="ad-desktop-card ingredients-card"
        *ngIf="!isMobile"
        role="complementary"
        aria-label="Sponsored content"
      >
        <span class="ad-badge">Ad</span>
        <app-dev-ads [type]="'mobile-banner'"></app-dev-ads>
      </div>
    </ng-container>
  </ng-container>
</div>

<div class="no-results-message" *ngIf="!loading && !ingredients.length">
  <p>No ingredients match your criteria. Try adjusting your filters!</p>
</div>

<!-- PAGINATION (come CocktailList) -->
<div class="pagination-container" *ngIf="!loading && totalPages > 1">
  <div class="pagination-controls">
    <button
      class="glass-button secondary"
      [disabled]="currentPage === 1"
      (click)="goToPage(currentPage - 1)"
      aria-label="Go to previous page"
    >
      Previous
    </button>

    <div class="page-numbers" role="navigation" aria-label="Pagination">
      <!-- Prima pagina -->
      <ng-container *ngIf="totalPages > 1">
        <span
          *ngIf="currentPage === 1"
          class="page-number active"
          aria-current="page"
        >
          1
        </span>
        <a
          *ngIf="currentPage !== 1"
          [attr.href]="buildUrlWithParams({ page: 1 })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(1)"
        >
          1
        </a>
      </ng-container>

      <!-- Ellissi sinistra -->
      <span *ngIf="showFirstEllipsis()" class="ellipsis" aria-hidden="true"
        >‚Ä¶</span
      >

      <!-- Pagine centrali -->
      <ng-container *ngFor="let page of getVisiblePages()">
        <span
          *ngIf="page === currentPage"
          class="page-number active"
          aria-current="page"
        >
          {{ page }}
        </span>
        <a
          *ngIf="page !== currentPage"
          [attr.href]="buildUrlWithParams({ page: page })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(page)"
        >
          {{ page }}
        </a>
      </ng-container>

      <!-- Ellissi destra -->
      <span *ngIf="showLastEllipsis()" class="ellipsis" aria-hidden="true"
        >‚Ä¶</span
      >

      <!-- Ultima pagina -->
      <ng-container *ngIf="totalPages > 1">
        <span
          *ngIf="currentPage === totalPages"
          class="page-number active"
          aria-current="page"
        >
          {{ totalPages }}
        </span>
        <a
          *ngIf="currentPage !== totalPages"
          [attr.href]="buildUrlWithParams({ page: totalPages })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(totalPages)"
        >
          {{ totalPages }}
        </a>
      </ng-container>
    </div>

    <button
      class="glass-button secondary"
      [disabled]="currentPage === totalPages"
      (click)="goToPage(currentPage + 1)"
      aria-label="Go to next page"
    >
      Next
    </button>
  </div>
</div>

<ng-container>
  <div
    *ngIf="isMobile"
    class="mobile-ad-container"
    role="complementary"
    aria-label="Sponsored content"
  >
    <span class="ad-badge">Ad</span>
    <app-dev-ads [type]="'mobile-banner'"></app-dev-ads>
  </div>

  <div
    class="ad-desktop-card"
    *ngIf="!isMobile"
    role="complementary"
    aria-label="Sponsored content"
  >
    <span class="ad-badge">Ad</span>
    <app-dev-ads [type]="'leaderboard'"></app-dev-ads>
  </div>
</ng-container>
<!--
<section class="glass-card">
  <h2 class="section-title">üõí Craft Cocktails with the Right Tools</h2>
  @defer (on viewport) {
  <div class="affiliate-card-list" #affiliateCardList>
    <div class="scrollerdiv">
      <ng-container *ngFor="let product of productList; let i = index">
        <div class="aff-item">
          <app-affiliate-product
            [title]="product.title"
            [imageUrl]="product.imageUrl"
            [price]="product.price"
            [link]="product.link"
            [showPlaceholder]="product.showPlaceholder"
          >
          </app-affiliate-product>
        </div>
      </ng-container>
    </div>
  </div>
  } @placeholder {
  <div class="affiliate-card-list placeholder" aria-hidden="true">
    <div class="scrollerdiv">
      <div class="aff-item skeleton"></div>
      <div class="aff-item skeleton"></div>
      <div class="aff-item skeleton"></div>
    </div>
  </div>
  }
  <p class="affiliate-bottom">
    We may receive a small commission if you purchase through these links ‚Äî it
    helps keep the shaker shaking! üôåüç∏
  </p>
</section>
-->
<div class="key-features-section">
  <h3>Why use Fizzando to explore ingredients?</h3>

  <div class="feature-item">
    <span class="feature-icon">üìö</span>
    <p>
      <b>Comprehensive Profiles:</b> Each ingredient includes image, ABV (when
      available), alcoholic/non-alcoholic flag, type, flavor notes, common uses,
      origin, storage tips, and suggested substitutes.
    </p>
  </div>

  <div class="feature-item">
    <span class="feature-icon">üîé</span>
    <p>
      <b>Smart Filters:</b> Use search, <b>Alcoholic/Non-Alcoholic</b>, and
      <b>Ingredient Type</b> to narrow results fast ‚Äî or jump to all
      <a href="/cocktails"><b>Cocktails</b></a> for inspiration.
    </p>
  </div>

  <div class="feature-item">
    <span class="feature-icon">üßë‚Äçüç≥</span>
    <p>
      <b>Craft with What You Have:</b> Try our
      <a href="/find-by-ingredients"><b>Find by Ingredients</b></a>
      tool to discover cocktails you can make with your current stock.
    </p>
  </div>

  <div class="feature-item">
    <span class="feature-icon">üéì</span>
    <p>
      <b>Learn & Improve:</b> Build knowledge with our
      <a href="/glossary"><b>Glossary</b></a> of bar terms, techniques, and prep
      methods.
    </p>
  </div>
</div>

@defer (on viewport) {
<div class="bottom-container">
  <div class="faq-section">
    <h2>Frequently Asked Questions about Ingredients</h2>

    <!-- TIPI INCLUSI -->
    <div class="faq-item" [class.expanded]="faqs[0].isExpanded">
      <button
        class="faq-question"
        type="button"
        (click)="toggleFaq(faqs[0])"
        [attr.aria-expanded]="faqs[0].isExpanded"
      >
        <span>What types of ingredients are included?</span>
        <mat-icon class="faq-toggle-icon" svgIcon="arrow_drop_down"></mat-icon>
      </button>
      <div
        #c0
        class="faq-answer-wrapper"
        [style.maxHeight.px]="faqs[0].isExpanded ? c0.scrollHeight : 0"
      >
        <p class="faq-answer">
          The archive covers <b>spirits</b>, <b>liqueurs & cordials</b>,
          <b>fortified wines</b>, <b>bitters</b>, <b>syrups & sweeteners</b>,
          <b>juices</b>, <b>mixers</b>, <b>fresh herbs</b>, <b>spices</b>,
          <b>fruits & vegetables</b>, and <b>dairy & eggs</b>.
        </p>
      </div>
    </div>

    <!-- COME LEGGERE LA CARD -->
    <div class="faq-item" [class.expanded]="faqs[1].isExpanded">
      <button
        class="faq-question"
        type="button"
        (click)="toggleFaq(faqs[1])"
        [attr.aria-expanded]="faqs[1].isExpanded"
      >
        <span>What information does each ingredient card show?</span>
        <mat-icon class="faq-toggle-icon" svgIcon="arrow_drop_down"></mat-icon>
      </button>
      <div
        #c1
        class="faq-answer-wrapper"
        [style.maxHeight.px]="faqs[1].isExpanded ? c1.scrollHeight : 0"
      >
        <p class="faq-answer">
          Each card highlights the <b>name</b>, <b>image</b>, <b>type</b>, and
          whether it‚Äôs <b>alcoholic</b> or <b>non-alcoholic</b>. Detailed pages
          may include <b>ABV</b>, <b>flavor profile</b>, <b>common uses</b>,
          <b>origin</b>, <b>storage tips</b>, and <b>substitutions</b>.
        </p>
      </div>
    </div>

    <!-- SOSTITUZIONI -->
    <div class="faq-item" [class.expanded]="faqs[2].isExpanded">
      <button
        class="faq-question"
        type="button"
        (click)="toggleFaq(faqs[2])"
        [attr.aria-expanded]="faqs[2].isExpanded"
      >
        <span>Can I substitute one ingredient for another?</span>
        <mat-icon class="faq-toggle-icon" svgIcon="arrow_drop_down"></mat-icon>
      </button>
      <div
        #c2
        class="faq-answer-wrapper"
        [style.maxHeight.px]="faqs[2].isExpanded ? c2.scrollHeight : 0"
      >
        <p class="faq-answer">
          Yes‚Äîmany ingredients have <b>practical substitutes</b>. For example,
          <b>Triple Sec</b> and <b>Cointreau</b> are often interchangeable;
          simple syrup can be adjusted with <b>rich syrup</b> (2:1) by reducing
          volume; fresh <b>lime</b> and <b>lemon</b> can sometimes swap with
          recipe-specific tweaks. Check the ingredient‚Äôs profile for guidance.
        </p>
      </div>
    </div>

    <!-- CONSERVAZIONE -->
    <div class="faq-item" [class.expanded]="faqs[3].isExpanded">
      <button
        class="faq-question"
        type="button"
        (click)="toggleFaq(faqs[3])"
        [attr.aria-expanded]="faqs[3].isExpanded"
      >
        <span>How should I store different ingredients?</span>
        <mat-icon class="faq-toggle-icon" svgIcon="arrow_drop_down"></mat-icon>
      </button>
      <div
        #c3
        class="faq-answer-wrapper"
        [style.maxHeight.px]="faqs[3].isExpanded ? c3.scrollHeight : 0"
      >
        <p class="faq-answer">
          Keep spirits and liqueurs in a <b>cool, dark place</b> with the cap
          tightly sealed. <b>Juices</b> and <b>syrups</b> go in the fridge after
          opening; label with a date. <b>Bitters</b> are shelf-stable.
          <b>Fresh herbs and fruit</b> are best used quickly; store herbs dry
          and chilled, and citrus whole rather than pre-juiced when possible.
        </p>
      </div>
    </div>

    <!-- ALCOL / ABV DEGLI INGREDIENTI -->
    <div class="faq-item" [class.expanded]="faqs[4].isExpanded">
      <button
        class="faq-question"
        type="button"
        (click)="toggleFaq(faqs[4])"
        [attr.aria-expanded]="faqs[4].isExpanded"
      >
        <span>How do I know if an ingredient contains alcohol?</span>
        <mat-icon class="faq-toggle-icon" svgIcon="arrow_drop_down"></mat-icon>
      </button>
      <div
        #c4
        class="faq-answer-wrapper"
        [style.maxHeight.px]="faqs[4].isExpanded ? c4.scrollHeight : 0"
      >
        <p class="faq-answer">
          Ingredients are tagged as <b>Alcoholic</b> or <b>Non-Alcoholic</b>.
          When available, we also list the <b>ABV</b>. Some items like
          <b>bitters</b> may contain alcohol but are typically used in very
          small amounts; check the product label and the ingredient profile.
        </p>
      </div>
    </div>

    <!-- OPZIONI ZERO-PROOF -->
    <div class="faq-item" [class.expanded]="faqs[5].isExpanded">
      <button
        class="faq-question"
        type="button"
        (click)="toggleFaq(faqs[5])"
        [attr.aria-expanded]="faqs[5].isExpanded"
      >
        <span>Are there non-alcoholic alternatives for common spirits?</span>
        <mat-icon class="faq-toggle-icon" svgIcon="arrow_drop_down"></mat-icon>
      </button>
      <div
        #c5
        class="faq-answer-wrapper"
        [style.maxHeight.px]="faqs[5].isExpanded ? c5.scrollHeight : 0"
      >
        <p class="faq-answer">
          Yes‚Äîthere are <b>zero-proof</b> botanicals that mimic gin, rum,
          tequila, whiskey, and aperitifs. You can also build flavor with
          <b>acid (citrus/verjuice)</b>, <b>bitterness</b> (tonic, tea),
          <b>spice</b> (ginger, pepper), and <b>texture</b> (aquafaba, rich
          syrups) to achieve balance without alcohol.
        </p>
      </div>
    </div>
  </div>

  <div
    class="banner-container"
    role="complementary"
    aria-label="Sponsored content"
  >
    <div class="banner-content">
      <span class="ad-badge">Ad</span>
      <ng-container>
        <app-dev-ads *ngIf="isMobile" [type]="'mobile-banner'"></app-dev-ads>
        <app-dev-ads *ngIf="!isMobile" [type]="'half-page'"></app-dev-ads>
      </ng-container>
    </div>
  </div>
</div>
} @placeholder {
<div class="bottom-container placeholder" aria-hidden="true">
  <div class="faq-section skeleton"></div>
  <div class="banner-container skeleton"></div>
</div>
}
