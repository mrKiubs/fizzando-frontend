<div class="page-header-container" [class.fonts-loaded]="fontsLoaded">
  <h1>Ingredient Explorer</h1>
  <h2>Search, Filter, and Learn About Cocktail Ingredients</h2>

  <p class="page-subtitle">
    Explore our <b>comprehensive ingredient archive</b>: spirits, liqueurs,
    mixers, juices, syrups, herbs, and more. Use the <b>smart filters</b> to
    find what you need.
  </p>
</div>

<!-- SEARCH (senza FormsModule, come CocktailList) -->
<div class="custom-search-input-wrapper">
  <input
    type="search"
    class="custom-search-input"
    placeholder="Search ingredient by name..."
    [value]="searchTerm()"
    (input)="onSearchInput($event)"
    aria-label="Search ingredient by name"
  />
  <mat-icon
    class="clear-search-icon"
    *ngIf="searchTerm()"
    (click)="clearFilters(); setSearch('')"
    svgIcon="close"
    aria-label="Clear search"
  ></mat-icon>
  <mat-icon class="search-icon" svgIcon="search" aria-hidden="true"></mat-icon>
</div>

<!-- FILTERS con @defer e chiusura con *ngIf (uniforme) -->
<div class="filters-accordion" [class.expanded]="isExpanded()">
  <div class="accordion-header" #filtersToggle (click)="toggleExpansion()">
    <h3 class="accordion-title">
      <mat-icon
        class="accordion-icon"
        svgIcon="filter_list"
        aria-hidden="true"
      ></mat-icon>
      Filters
    </h3>
    <span class="active-filters-summary" *ngIf="!isExpanded()">
      ({{ getActiveFiltersText() }})
    </span>
  </div>

  @defer (on interaction(filtersToggle); prefetch on idle) {
  <div class="accordion-content" *ngIf="isExpanded()">
    <div class="filter-group">
      <label for="alcoholic-select" class="filter-label"
        >Alcoholic / Non-Alcoholic</label
      >
      <div class="custom-select-wrapper">
        <select
          id="alcoholic-select"
          class="custom-select"
          [value]="
            selectedAlcoholic() === 'true'
              ? 'Alcoholic'
              : selectedAlcoholic() === 'false'
              ? 'Non-Alcoholic'
              : ''
          "
          (change)="setAlcoholicUi($any($event.target).value)"
          (change)="setType($any($event.target).value)"
          (click)="$event.stopPropagation()"
          aria-label="Filter by alcoholic content"
        >
          <option value="">All</option>
          <option *ngFor="let option of alcoholicOptions" [value]="option">
            {{ option }}
          </option>
        </select>
        <mat-icon
          class="select-arrow-icon"
          svgIcon="arrow_drop_down"
          aria-hidden="true"
        ></mat-icon>
      </div>
    </div>

    <div class="filter-group">
      <label for="type-select" class="filter-label">Ingredient Type</label>
      <div class="custom-select-wrapper">
        <select
          id="type-select"
          class="custom-select"
          [value]="selectedType()"
          (change)="setAlcoholicUi($any($event.target).value)"
          (change)="setType($any($event.target).value)"
          (click)="$event.stopPropagation()"
          aria-label="Filter by ingredient type"
        >
          <option value="">All Types</option>
          <option *ngFor="let t of ingredientTypes" [value]="t">{{ t }}</option>
        </select>
        <mat-icon
          class="select-arrow-icon"
          svgIcon="arrow_drop_down"
          aria-hidden="true"
        ></mat-icon>
      </div>
    </div>

    <div class="filter-group filter-button-row">
      <button
        class="glass-button secondary"
        (click)="clearFilters()"
        aria-label="Clear all filters"
      >
        <mat-icon svgIcon="clear_all" aria-hidden="true"></mat-icon>
        Clear Filters
      </button>
    </div>
  </div>
  } @placeholder {
  <div class="accordion-content placeholder" aria-hidden="true"></div>
  }
</div>

<hr />

<p class="ingredient-card-legend">
  Each card shows the ingredient <b>image</b> and whether it's
  <b>alcoholic</b> or <b>non-alcoholic</b>. Click an ingredient to view full
  details!
</p>

<div *ngIf="loading" class="loading-message">Loading ingredients...</div>
<div *ngIf="error" class="error-message">{{ error }}</div>

<!-- STATUS PAGINA / RISULTATI (come CocktailList) -->
<div
  class="page-status"
  *ngIf="!loading && !error && totalItems > 0"
  role="status"
  aria-live="polite"
>
  <span class="page-status__page"
    >Page {{ currentPage }} of {{ totalPages }}</span
  >
  <span class="page-status__sep" aria-hidden="true">•</span>
  <span class="page-status__range">
    Showing {{ pageStart }}–{{ pageEnd }} of {{ totalItems }}
  </span>
</div>

<!-- Skeleton quando loading -->
<div
  class="page-status page-status--skeleton"
  *ngIf="loading"
  aria-hidden="true"
>
  <span class="skl w-28"></span>
  <span class="skl w-6"></span>
  <span class="skl w-48"></span>
</div>

<!-- GRID (riuso classi .cocktail-list se già stilate) -->
<div class="cocktail-list" *ngIf="!error && ingredients.length > 0">
  <app-ingredient-card
    *ngFor="let ingredient of ingredients; let i = index; trackBy: trackById"
    [ingredient]="ingredient"
    [lazyLoadImage]="i >= 6"
  ></app-ingredient-card>
</div>

<div class="no-results-message" *ngIf="!loading && !ingredients.length">
  <p>No ingredients match your criteria. Try adjusting your filters!</p>
</div>

<!-- PAGINATION (come CocktailList) -->
<div class="pagination-container" *ngIf="!loading && totalPages > 1">
  <div class="pagination-controls">
    <button
      class="glass-button secondary"
      [disabled]="currentPage === 1"
      (click)="goToPage(currentPage - 1)"
      aria-label="Go to previous page"
    >
      Previous
    </button>

    <div class="page-numbers" role="navigation" aria-label="Pagination">
      <!-- Prima pagina -->
      <ng-container *ngIf="totalPages > 1">
        <span
          *ngIf="currentPage === 1"
          class="page-number active"
          aria-current="page"
        >
          1
        </span>
        <a
          *ngIf="currentPage !== 1"
          [attr.href]="buildUrlWithParams({ page: 1 })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(1)"
        >
          1
        </a>
      </ng-container>

      <!-- Ellissi sinistra -->
      <span *ngIf="showFirstEllipsis()" class="ellipsis" aria-hidden="true"
        >…</span
      >

      <!-- Pagine centrali -->
      <ng-container *ngFor="let page of getVisiblePages()">
        <span
          *ngIf="page === currentPage"
          class="page-number active"
          aria-current="page"
        >
          {{ page }}
        </span>
        <a
          *ngIf="page !== currentPage"
          [attr.href]="buildUrlWithParams({ page: page })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(page)"
        >
          {{ page }}
        </a>
      </ng-container>

      <!-- Ellissi destra -->
      <span *ngIf="showLastEllipsis()" class="ellipsis" aria-hidden="true"
        >…</span
      >

      <!-- Ultima pagina -->
      <ng-container *ngIf="totalPages > 1">
        <span
          *ngIf="currentPage === totalPages"
          class="page-number active"
          aria-current="page"
        >
          {{ totalPages }}
        </span>
        <a
          *ngIf="currentPage !== totalPages"
          [attr.href]="buildUrlWithParams({ page: totalPages })"
          class="page-number"
          (click)="$event.preventDefault(); goToPage(totalPages)"
        >
          {{ totalPages }}
        </a>
      </ng-container>
    </div>

    <button
      class="glass-button secondary"
      [disabled]="currentPage === totalPages"
      (click)="goToPage(currentPage + 1)"
      aria-label="Go to next page"
    >
      Next
    </button>
  </div>
</div>

<!-- FAQ (opzionale, in linea al pattern) -->
<div class="faq-section">
  <h2>Frequently Asked Questions about Ingredients</h2>

  <div class="faq-item" [class.expanded]="faqs[0].isExpanded">
    <button
      class="faq-question"
      type="button"
      (click)="faqs[0].isExpanded = !faqs[0].isExpanded"
      [attr.aria-expanded]="faqs[0].isExpanded"
    >
      <span>What types of ingredients can I find here?</span>
      <mat-icon class="faq-toggle-icon" svgIcon="arrow_drop_down"></mat-icon>
    </button>
    <div
      class="faq-answer-wrapper"
      [style.maxHeight.px]="faqs[0].isExpanded ? 200 : 0"
    >
      <p class="faq-answer">
        Alcoholic bases (spirits, liqueurs), non-alcoholic mixers (juices,
        syrups, sodas), herbs, spices and garnishes.
      </p>
    </div>
  </div>

  <div class="faq-item" [class.expanded]="faqs[1].isExpanded">
    <button
      class="faq-question"
      type="button"
      (click)="faqs[1].isExpanded = !faqs[1].isExpanded"
      [attr.aria-expanded]="faqs[1].isExpanded"
    >
      <span>How can I search for a specific ingredient?</span>
      <mat-icon class="faq-toggle-icon" svgIcon="arrow_drop_down"></mat-icon>
    </button>
    <div
      class="faq-answer-wrapper"
      [style.maxHeight.px]="faqs[1].isExpanded ? 200 : 0"
    >
      <p class="faq-answer">
        Use the search bar and filters above. Results update and paginate with
        clean URLs.
      </p>
    </div>
  </div>
</div>
