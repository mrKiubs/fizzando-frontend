<div class="detail-wrapper ingredient-detail-wrapper">
  <!-- Loading / Error -->
  <div *ngIf="loading" class="loading-message glass-card">
    <mat-icon class="loading-icon" svgIcon="hourglass_empty"></mat-icon>
    <p>Loading ingredient details...</p>
  </div>

  <div *ngIf="error" class="error-message glass-card">
    <mat-icon color="warn" svgIcon="error"></mat-icon>
    <span>{{ error }}</span>
    <button class="glass-button secondary" (click)="goBack()">
      <mat-icon svgIcon="arrow_back"></mat-icon> Go Back
    </button>
  </div>

  <!-- Main content -->
  <div *ngIf="!loading && ingredient" class="ingredient-detail-grid">
    <!-- Header principale -->
    <section class="main-ingredient-header glass-card">
      <div class="header-content">
        <div class="ingredient-main-image-wrapper">
          <!-- ✅ LCP-optimized hero -->
          <img
            class="ingredient-image-circular"
            [ngSrc]="getIngredientImageUrl(ingredient)"
            alt="{{ ingredient.name }}"
            width="100"
            height="100"
            loading="eager"
            fetchpriority="high"
            decoding="async"
            sizes="(max-width: 150px) 100vw, (max-width: 150px) 50vw, 33vw"
          />
        </div>

        <div>
          <h1 class="ingredient-title justify-left">{{ ingredient.name }}</h1>

          <h2 class="ingredient-subtitle">
            {{ ingredient.isAlcoholic ? "Alcoholic" : "Non-Alcoholic" }}
            <span
              *ngIf="
                ingredient?.ai_alcohol_content &&
                ingredient.ai_alcohol_content !== 'Non-alcoholic'
              "
            >
              (<ng-container
                *ngIf="
                  +('' + ingredient.ai_alcohol_content).replace('%', '') !== 0
                "
                >~</ng-container
              >{{ ingredient.ai_alcohol_content | formatAbv }})
            </span>

            <span
              *ngIf="ingredient.ingredient_type"
              class="ml-2 px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full inline-block"
            >
              {{ ingredient.ingredient_type }}
            </span>
          </h2>

          <p class="ingredient-description">
            {{
              ingredient.description_from_cocktaildb ||
                ingredient.ai_flavor_profile ||
                ingredient.ai_common_uses
            }}
          </p>
        </div>
      </div>
    </section>

    <div class="ad-block">
      <ng-container>
        <div
          *ngIf="isMobile"
          class="mobile-ad-container"
          role="complementary"
          aria-label="Sponsored content"
        >
          <span class="ad-badge">Ad</span>
          <app-dev-ads [type]="'mobile-banner'"></app-dev-ads>
        </div>

        <div
          class="ad-desktop-card"
          *ngIf="!isMobile"
          role="complementary"
          aria-label="Sponsored content"
        >
          <span class="ad-badge">Ad</span>
          <app-dev-ads [type]="'leaderboard'"></app-dev-ads>
        </div>
      </ng-container>
    </div>

    <!-- AI Insights -->
    <section class="ai-insights-section glass-card">
      <h2 class="section-title">
        🔬 In-depth Details of {{ ingredient.name }}
      </h2>
      <div class="ai-blocks-grid">
        <div
          class="ai-detail-block glass-card-mini"
          *ngIf="ingredient.ai_flavor_profile"
        >
          <h3 class="ai-block-title">👅 Flavor Profile</h3>
          <p>{{ ingredient.ai_flavor_profile }}</p>
        </div>

        <div
          class="ai-detail-block glass-card-mini"
          *ngIf="ingredient.ai_common_uses"
        >
          <h3 class="ai-block-title">🥂 Common Uses</h3>
          <p>{{ ingredient.ai_common_uses }}</p>
        </div>

        <div
          class="ai-detail-block glass-card-mini"
          *ngIf="ingredient.ai_substitutes"
        >
          <h3 class="ai-block-title">🔄 Substitutes</h3>
          <p>{{ ingredient.ai_substitutes }}</p>
        </div>

        <div
          class="ai-detail-block glass-card-mini"
          *ngIf="ingredient.ai_brief_history"
        >
          <h3 class="ai-block-title">📜 Brief History</h3>
          <p>{{ ingredient.ai_brief_history }}</p>
        </div>

        <div
          class="ai-detail-block glass-card-mini"
          *ngIf="ingredient.ai_interesting_facts"
        >
          <h3 class="ai-block-title">💡 Interesting Facts</h3>
          <p>{{ ingredient.ai_interesting_facts }}</p>
        </div>
        <!--
        <div
          class="ai-detail-block glass-card-mini full-width"
          *ngIf="ingredient.ai_cocktail_substitutes"
        >
          <h3 class="ai-block-title">🍹 AI Cocktail Substitutes</h3>
          <pre class="json-display">{{
            ingredient.ai_cocktail_substitutes | json
          }}</pre>
        </div>
        -->
      </div>
    </section>

    <!-- Related Cocktails (1 ad ogni 6 card) -->
    <section class="related-cocktails-section glass-card">
      <h2 class="section-title">🍹 Cocktails using {{ ingredient.name }}</h2>

      <div
        *ngIf="
          ingredient.relatedCocktails && ingredient.relatedCocktails.length > 0
        "
        class="related-cocktail-cards-grid"
      >
        <ng-container *ngFor="let item of getCocktailsAndAds(); let i = index">
          <ng-container *ngIf="isCocktailItem(item); else adBlock">
            <app-cocktail-card
              [cocktail]="item"
              [routerLink]="['/cocktails', item.slug]"
            ></app-cocktail-card>
          </ng-container>

          <ng-template #adBlock>
            <div
              *ngIf="isMobile"
              class="mobile-ad-container"
              role="complementary"
              aria-label="Sponsored content"
            >
              <span class="ad-badge">Ad</span>
              <app-dev-ads [type]="'mobile-banner'"></app-dev-ads>
            </div>

            <div
              class="ad-desktop-card"
              *ngIf="!isMobile"
              role="complementary"
              aria-label="Sponsored content"
            >
              <span class="ad-badge">Ad</span>
              <app-dev-ads [type]="'square'"></app-dev-ads>
            </div>
          </ng-template>
        </ng-container>
      </div>

      <p
        *ngIf="
          !ingredient.relatedCocktails ||
          ingredient.relatedCocktails.length === 0
        "
        class="no-related-cocktails"
      >
        🤷‍♂️ No cocktails found that use this ingredient.
      </p>
    </section>
  </div>

  <!-- Navigation -->
  <div
    class="navigation-bar"
    *ngIf="!loading && !error"
    role="navigation"
    aria-label="Ingredient navigation"
  >
    <div class="nav-top">
      <!-- PREVIOUS -->
      <a
        *ngIf="previousIngredient"
        [routerLink]="['/ingredients', previousIngredient.externalId]"
        class="glass-button secondary nav-button"
        [attr.aria-label]="
          'Previous ingredient: ' + (previousIngredient?.name || '')
        "
      >
        <mat-icon svgIcon="chevron_left" aria-hidden="true"></mat-icon>

        <div class="ingredient-image-wrapper-nav" aria-hidden="true">
          <img
            [src]="previousIngredient.imageUrl"
            alt=""
            class="nav-ingredient-image"
            width="36"
            height="36"
            loading="lazy"
            decoding="async"
            [attr.fetchpriority]="'low'"
            role="presentation"
          />
        </div>

        {{ previousIngredient.name }}
      </a>
      <span *ngIf="!previousIngredient" class="nav-placeholder"></span>

      <!-- NEXT -->
      <a
        *ngIf="nextIngredient"
        [routerLink]="['/ingredients', nextIngredient.externalId]"
        class="glass-button secondary nav-button"
        [attr.aria-label]="'Next ingredient: ' + (nextIngredient?.name || '')"
      >
        {{ nextIngredient.name }}

        <div class="ingredient-image-wrapper-nav" aria-hidden="true">
          <img
            [src]="nextIngredient.imageUrl"
            alt=""
            class="nav-ingredient-image"
            width="36"
            height="36"
            loading="lazy"
            decoding="async"
            [attr.fetchpriority]="'low'"
            role="presentation"
          />
        </div>

        <mat-icon svgIcon="chevron_right" aria-hidden="true"></mat-icon>
      </a>
      <span *ngIf="!nextIngredient" class="nav-placeholder"></span>
    </div>

    <div class="nav-bottom">
      <button class="glass-button secondary" (click)="goBack()">
        <mat-icon svgIcon="arrow_back" aria-hidden="true"></mat-icon>
        <span>Go Back</span>
      </button>
    </div>
  </div>

  <!-- Bottom banner -->
  <ng-container *ngIf="!loading && !error">
    <div
      *ngIf="isMobile"
      class="mobile-ad-container"
      role="complementary"
      aria-label="Sponsored content"
    >
      <span class="ad-badge">Ad</span>
      <app-dev-ads [type]="'mobile-banner'"></app-dev-ads>
    </div>

    <div
      class="ad-desktop-card"
      *ngIf="!isMobile"
      role="complementary"
      aria-label="Sponsored content"
    >
      <span class="ad-badge">Ad</span>
      <app-dev-ads [type]="'leaderboard'"></app-dev-ads>
    </div>
  </ng-container>
</div>
