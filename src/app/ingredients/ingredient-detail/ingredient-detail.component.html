<div class="detail-wrapper">
  <div *ngIf="loading" class="loading-message glass-card">
    <mat-icon class="loading-icon" svgIcon="hourglass_empty"></mat-icon>
    <p>Loading ingredient details...</p>
  </div>

  <div *ngIf="error" class="error-message glass-card">
    <mat-icon color="warn" svgIcon="error"></mat-icon>
    <span>{{ error }}</span>
    <button class="glass-button secondary" (click)="goBack()">
      <mat-icon svgIcon="arrow_back"></mat-icon> Go Back
    </button>
  </div>

  <div *ngIf="!loading && ingredient" class="ingredient-detail-grid">
    <!-- Header principale -->
    <section class="main-ingredient-header glass-card">
      <div class="header-content">
        <div class="ingredient-main-image-wrapper">
          <img
            [src]="getIngredientImageUrl(ingredient)"
            [alt]="ingredient.name"
            class="ingredient-image-circular"
          />
        </div>
        <div>
          <h1 class="ingredient-title justify-left">{{ ingredient.name }}</h1>
          <h2 class="ingredient-subtitle">
            {{ ingredient.isAlcoholic ? "Alcoholic" : "Non-Alcoholic" }}
            <span
              *ngIf="
                ingredient.ai_alcohol_content &&
                ingredient.ai_alcohol_content !== 'Non-alcoholic'
              "
            >
              ({{ ingredient.ai_alcohol_content | formatAbv }})
            </span>
            <!-- NUOVO: Tipo di Ingrediente -->
            <span
              *ngIf="ingredient.ingredient_type"
              class="ml-2 px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full inline-block"
            >
              {{ ingredient.ingredient_type }}
            </span>
          </h2>
          <p class="ingredient-description">
            {{ ingredient.description_from_cocktaildb | formatAbv }}
          </p>
        </div>
      </div>
    </section>

    <!-- Sezione AI Insights -->
    <section class="ai-insights-section glass-card">
      <h2 class="section-title">
        🔬 In‑depth Details of {{ ingredient.name }}
      </h2>
      <div class="ai-blocks-grid">
        <div
          class="ai-detail-block glass-card-mini"
          *ngIf="ingredient.ai_flavor_profile"
        >
          <h3 class="ai-block-title">👅 Flavor Profile</h3>
          <p>{{ ingredient.ai_flavor_profile }}</p>
        </div>
        <div
          class="ai-detail-block glass-card-mini"
          *ngIf="ingredient.ai_common_uses"
        >
          <h3 class="ai-block-title">🥂 Common Uses</h3>
          <p>{{ ingredient.ai_common_uses }}</p>
        </div>
        <div
          class="ai-detail-block glass-card-mini"
          *ngIf="ingredient.ai_substitutes"
        >
          <h3 class="ai-block-title">🔄 Substitutes</h3>
          <p>{{ ingredient.ai_substitutes }}</p>
        </div>
        <div
          class="ai-detail-block glass-card-mini"
          *ngIf="ingredient.ai_brief_history"
        >
          <h3 class="ai-block-title">📜 Brief History</h3>
          <p>{{ ingredient.ai_brief_history }}</p>
        </div>
        <div
          class="ai-detail-block glass-card-mini"
          *ngIf="ingredient.ai_interesting_facts"
        >
          <h3 class="ai-block-title">💡 Interesting Facts</h3>
          <p>{{ ingredient.ai_interesting_facts }}</p>
        </div>
        <!-- NUOVO: ai_cocktail_substitutes (JSON) -->
        <div
          class="ai-detail-block glass-card-mini full-width"
          *ngIf="ingredient.ai_cocktail_substitutes"
        >
          <h3 class="ai-block-title">🍹 AI Cocktail Substitutes</h3>
          <pre class="json-display">{{
            ingredient.ai_cocktail_substitutes | json
          }}</pre>
        </div>
      </div>
    </section>

    <!-- Sezione Articolo Correlato -->
    <section
      class="related-article-section glass-card"
      *ngIf="ingredient.article"
    >
      <h2 class="section-title">📚 Related Article</h2>
      <div class="article-link-block">
        <mat-icon svgIcon="article"></mat-icon>
        <a
          [routerLink]="['/articles', ingredient.article.slug]"
          class="text-blue-600 hover:underline font-semibold text-lg"
        >
          {{ ingredient.article.title }}
        </a>
      </div>
      <p class="text-gray-700 text-sm mt-2">
        {{ ingredient.article.content.substring(0, 150) }}...
      </p>
    </section>

    <!-- Sezione Correlati -->
    <section class="related-cocktails-section glass-card">
      <h2 class="section-title">🍹 Cocktails using {{ ingredient.name }}</h2>
      <div
        *ngIf="
          ingredient.relatedCocktails && ingredient.relatedCocktails.length > 0
        "
        class="related-cocktail-cards-grid"
      >
        <app-cocktail-card
          *ngFor="
            let cocktail of ingredient.relatedCocktails;
            trackBy: trackByCocktailId
          "
          [cocktail]="cocktail"
        ></app-cocktail-card>
      </div>
      <p
        *ngIf="
          !ingredient.relatedCocktails ||
          ingredient.relatedCocktails.length === 0
        "
        class="no-related-cocktails"
      >
        🤷‍♂️ No cocktails found that use this ingredient.
      </p>
    </section>
  </div>
  <div class="navigation-bar" *ngIf="!loading && !error">
    <div class="nav-top">
      <a
        *ngIf="previousIngredient"
        [routerLink]="['/ingredients', previousIngredient.externalId]"
        class="glass-button secondary nav-button"
      >
        <mat-icon svgIcon="chevron_left"></mat-icon>
        <div class="ingredient-image-wrapper-nav">
          <img
            [src]="previousIngredient.imageUrl"
            alt="{{ previousIngredient.name }}"
            class="nav-ingredient-image"
          />
        </div>
        {{ previousIngredient.name }}
      </a>
      <span *ngIf="!previousIngredient" class="nav-placeholder"></span>

      <a
        *ngIf="nextIngredient"
        [routerLink]="['/ingredients', nextIngredient.externalId]"
        class="glass-button secondary nav-button"
      >
        {{ nextIngredient.name }}
        <div class="ingredient-image-wrapper-nav">
          <img
            [src]="nextIngredient.imageUrl"
            alt="{{ nextIngredient.name }}"
            class="nav-ingredient-image"
          />
        </div>
        <mat-icon svgIcon="chevron_right"></mat-icon>
      </a>
      <span *ngIf="!nextIngredient" class="nav-placeholder"></span>
    </div>
    <div class="nav-bottom">
      <button class="glass-button secondary" (click)="goBack()">
        <mat-icon svgIcon="arrow_back"></mat-icon> Go Back
      </button>
    </div>
  </div>
</div>
