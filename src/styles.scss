// Custom Theming for Angular Material
// For more information: https://material.angular.dev/guide/theming
//@use "@angular/material" as mat;
@use "app/assets/style/mixins" as m;
@use "app/assets/style/main.scss" as *;

/* Inter: importa solo i pesi che usi davvero (solo subset latin) */
@import "@fontsource/inter/latin-300.css";
@import "@fontsource/inter/latin-700.css";

/* Bebas Neue (latin only) */
@import "@fontsource/bebas-neue/latin-400.css";

/* Metric fallback per prevenire CLS quando i font non sono ancora pronti */
@font-face {
  font-family: "Inter Fallback";
  src: local("Arial");
  ascent-override: 92.5%;
  descent-override: 24%;
  line-gap-override: 0%;
  size-adjust: 101.5%;
}

@font-face {
  font-family: "Bebas Neue Fallback";
  src: local("Arial Narrow"), local("Arial");
  ascent-override: 93%;
  descent-override: 7%;
  line-gap-override: 0%;
  size-adjust: 99%;
}

/* Font-family globali */
:root {
  --font-sans: "Inter", "Inter Fallback", system-ui, -apple-system, "Segoe UI",
    Roboto, Arial, sans-serif;
  --font-display: "Bebas Neue", "Bebas Neue Fallback", var(--font-sans);
}

html,
body {
  font-family: var(--font-sans);
}

/* ====== Base font stack ====== */
:root {
  font-synthesis: none;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --app-vh: 100vh;
  --app-lvh: 100vh;
  --app-viewport-extent: max(var(--app-vh), var(--app-lvh));
  --header-height: 64px;
}

@supports (height: 100svh) {
  :root {
    --app-vh: 100svh;
  }
}

@supports (height: 100dvh) {
  :root {
    --app-vh: 100dvh;
  }
}

@supports (height: 100lvh) {
  :root {
    --app-lvh: 100lvh;
  }
}

html,
body {
  height: 100%;
}

body {
  margin: 0;
  min-height: 100svh;
  min-height: var(--app-vh);
  padding-top: 0;
  scroll-padding-top: calc(var(--header-height) + var(--safe-top));
  overscroll-behavior: contain;
}

header.app-header {
  position: sticky;
  top: 0;
  height: calc(var(--header-height) + var(--safe-top));
  will-change: transform;
  backface-visibility: hidden;
}

.fullscreen-section {
  height: calc(
    var(--app-vh) - var(--header-height) - var(--safe-top) - var(--safe-bottom)
  );
}

.ios-fixed header.app-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

header.app-header.ios-fixed {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}
.ios-fixed body,
body.ios-fixed {
  padding-top: calc(var(--header-height) + var(--safe-top));
}
html {
  scrollbar-gutter: stable;
}
* {
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

@media (hover: none) and (pointer: coarse) {
  :where(
      a,
      button,
      input[type="button"],
      input[type="submit"],
      input[type="reset"],
      [role="button"]
    ):not(.no-touch-feedback) {
    @include m.touch-press-feedback();
  }

  .no-touch-feedback {
    @include m.disable-touch-feedback();
  }
}

@media (hover: none) and (pointer: coarse) and (prefers-reduced-motion: reduce) {
  :where(
      a,
      button,
      input[type="button"],
      input[type="submit"],
      input[type="reset"],
      [role="button"]
    ):not(.no-touch-feedback) {
    --touch-press-active-transform: none;
    --touch-press-active-filter: none;
    transition-duration: 0ms;
  }
}
/* ====== Riduzione CLS: allinea x-height tra fallback e webfont ====== */

h1,
h2,
h3,
h4,
h5,
h6,
.logo-text,
.ingredient-link {
  font-family: var(--font-display);
  letter-spacing: 2px;

  font-weight: 700;
  line-height: 1.2;

  color: #ffffff;
  -webkit-text-fill-color: #ffffff;

  /* leggerissimo contorno per leggibilità su sfondi chiari */
  text-shadow: 0 0.5px 0 rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.12);

  /* opzionale: stesso spacing elegante */
  letter-spacing: 1.3px;

  &.match-motto {
    -webkit-background-clip: initial !important;
    background-clip: border-box !important;
    background-image: none !important;
    background: rgb(0 0 0 / 5%) !important;
    -webkit-text-fill-color: currentColor !important;
    color: #ffffff !important;
    text-shadow: none !important;
    filter: none !important;

    @media (min-width: 600px) {
      background: rgb(0 0 0 / 55%) !important;
    }
  }
}
@supports ((-webkit-background-clip: text) or (background-clip: text)) {
  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  .logo-text,
  .ingredient-link {
    /* testo trasparente con gradiente applicato */
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    -webkit-text-fill-color: transparent;

    /* gradiente neutro chiaro, effetto vetro */
    background-image: linear-gradient(
      120deg,
      #f7c8c8 0%,
      #f6e1b9 25%,
      #d7f8ea 50%,
      #c9e0f6 75%,
      #e5d8f7 100%
    );
  }
}

/* ====== (Opzionale) fallback universale del “contorno” titolo cross-browser ====== */
/* Evita -webkit-text-stroke: usa un leggero text-shadow visibile su Firefox */

/* ====== Mantieni il tuo background ====== */

.page-header-container h1 {
  font-weight: 600;
  font-size: 34px; /* ↑ più grande su mobile */
  line-height: 38px;
  margin: 0;

  /* anti-CLS: riserva 1 riga finché i font non sono pronti */
  min-height: 38px;
}

.page-header-container h2 {
  text-align: center;
}

/* Desktop / tablet */
@media (min-width: 768px) {
  .page-header-container h1 {
    font-size: 46px; /* come prima */
    line-height: 50px;

    /* anti-CLS desktop */
    min-height: 50px;
  }
}

/* quando i font sono caricati, togli la riserva */
.cocktails-page.fonts-loaded .page-header-container h1 {
  min-height: 0;
}

mat-icon,
.mat-icon {
  font-family: "Material Icons" !important;
  font-weight: normal !important;
  font-style: normal !important;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: "liga";
  -webkit-font-smoothing: antialiased;
}
/* Spazio riservato e metrica stabile per tutte le icone material */
.mat-icon,
.material-icons {
  display: inline-block;
  width: 24px; /* o 20/24/28px: usa la misura che adopera la tua UI */
  height: 24px;
  line-height: 24px;
  font-size: 24px;
  vertical-align: middle;
  /* evita reflow se il font ancora non è pronto */
  overflow: hidden;
  white-space: nowrap;
}

/* 1) Lista: card testi stabili (evita shift in .cocktail-list) */
.cocktail-list .cocktail-card {
  /* Garantiamo che immagine e testo non facciano saltare la griglia */
  .cocktail-card-image {
    display: block;
    width: 100%;
    /* se non l’hai già: fissa l’aspect ratio dell’area immagine */
    aspect-ratio: 1 / 1; /* adatta al tuo design */
    object-fit: cover;
  }

  /* Titolo card: 2 righe riservate */
  .card-title {
    font-weight: 700; /* o quello che usi */
    line-height: 1.2; /* fisso */
    /* Riserva spazio per esattamente 2 righe (adatta font-size se diverso) */
    /* se il titolo è 18px: 2 * 1.2 * 18 = 43.2 → 44px */
    min-height: 2.4em; /* 2 righe * line-height (1.2) */
    display: -webkit-box;
    -webkit-line-clamp: 2; /* clamp a 2 righe */
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Sottotitolo/metadata (ABV, bicchiere, ecc.): 1 riga riservata */
  .card-meta {
    line-height: 1.2;
    min-height: 1.2em;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }

  /* eventuali badge/icone ingredienti: fissa altezza riga */
  .ingredient-row {
    line-height: 24px;
    min-height: 24px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .ingredient-row img,
  .ingredient-icon {
    width: 20px;
    height: 20px;
    flex: 0 0 20px;
    display: inline-block;
  }
}

/* 2) Titolo pagina (H1) – evita micro-shift quando applica il webfont */
.page-title,
h1 {
  line-height: 1.1;
  min-height: 1.1em; /* riserva l’altezza di una riga */
  /* opzionale: se hai margini che collassano, fissa padding per stabilità */
  padding-top: 0.01px; /* hack innocuo che previene piccoli collassi */
}

/* 3) Mat icon già stabilizzate (lascia se non l’hai messo prima) */
.mat-icon,
.material-icons {
  display: inline-block;
  width: 24px;
  height: 24px;
  line-height: 24px;
  font-size: 24px;
  vertical-align: middle;
  overflow: hidden;
  white-space: nowrap;
}

.cocktail-image-column .image-wrapper {
}
.detail-image {
  display: block;
  width: 100%;
  height: auto;
  aspect-ratio: 1 / 1;
}

/* BASE: tutti i mobile */
@media (max-width: 768px) {
  html {
    -webkit-text-size-adjust: 110%;
    text-size-adjust: 110%;
  }
}

/* RETINA 2x+ (Pixel A compresi) */
@media (max-width: 768px) and (min-resolution: 2dppx) {
  html {
    -webkit-text-size-adjust: 114%;
    text-size-adjust: 114%;
  }
}

/* RETINA 3x+ (iPhone recenti, probabilmente anche 16e) */
@media (max-width: 768px) and (min-resolution: 3dppx) {
  html {
    -webkit-text-size-adjust: 118%;
    text-size-adjust: 118%;
  }
}

/* iOS TUNE: Safari iOS rende i font un filo più piccoli → spingiamo un po' di più.
   Messo DOPO per sovrascrivere le regole sopra solo su iOS. */
@supports (-webkit-touch-callout: none) {
  @media (max-width: 768px) {
    html {
      -webkit-text-size-adjust: 116%;
    }
  }
  @media (max-width: 768px) and (min-resolution: 3dppx) {
    html {
      -webkit-text-size-adjust: 120%;
    }
  }
}
.brand-link {
  -webkit-text-size-adjust: none;
  text-size-adjust: none;
}

/* Card grids — MAX 4 per riga desktop */
.cards-grid {
  display: grid;
  gap: 16px;
}
.cards-grid.limit-4 {
  grid-template-columns: repeat(1, minmax(0, 1fr));
}
.cards-grid > * {
  min-width: 0;
}

@media (min-width: 600px) {
  .cards-grid.limit-4 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

@media (min-width: 728px) {
  .cards-grid.limit-4 {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}
/* Tablet */
@media (min-width: 1024px) {
  .cards-grid.limit-4 {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
}

/* Mobile */
:where([hidden]) {
  display: none !important;
}
.app-main.is-animating {
  overflow: hidden; // evita comparsa/scomparsa scrollbar durante il transition
}
@media (prefers-reduced-motion: reduce) {
  :root .app-main.allow-route-anim > * {
    animation: initial !important;
    transition: initial !important;
  }
}

/* === TOUCH FEEDBACK (solo dispositivi touch, nessun effetto su desktop) === */
@media (hover: none) and (pointer: coarse) {
  /* --- principali elementi interattivi --- */
  .glassy-info-link:active,
  .cocktail-card-link-wrapper:active,
  .card-type:active,
  .cocktail-chip:active {
    filter: brightness(1.25); /* leggero flash luminoso */
    transform: scale(0.97); /* effetto “premuto” */
    transition: filter 0.15s ease, transform 0.1s ease;
  }

  /* --- stato neutro: transizione morbida per ritorno --- */
  .glassy-info-link,
  .cocktail-card-link-wrapper,
  .card-type,
  .cocktail-chip {
    transition: filter 0.2s ease, transform 0.15s ease;
  }

  /* --- opzionale: tocco sui chip più evidente --- */
  .cocktail-chip:active {
    background-color: rgba(255, 255, 255, 0.12); /* flash leggero nel blur */
  }
}

@keyframes popup {
  from {
    opacity: 0;
    transform: translateY(100px);
  }
  to {
    opacity: 1;
    transform: translateY(0px);
  }
}

/* Lazy image fade-in */
img.lazy-image-fade {
  opacity: 0;
  transition: opacity 220ms ease-out;
  will-change: opacity;
}

img.lazy-image-fade.lazy-image-fade--loaded {
  opacity: 1;
}

@media (prefers-reduced-motion: reduce) {
  img.lazy-image-fade {
    transition-duration: 0ms;
  }
}
